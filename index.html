<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ููุตุฉ ุงูุชุญููู ูุงูุชุญุณูู ุงููุฏุฑุณู โ ุซุงูููุฉ ุงููุนููุจู</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
<!-- Supabase (ุงุฎุชูุงุฑู ููุณุญุงุจุฉ) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root{
  --moe:#0b7e88; --ink:#06353b; --bg:#f5f8f8; --card:#ffffff;
  --shine1:#e8fbfb; --shine2:#d9f2f3; --muted:#6f8e94;
  --ok:#e9fff4; --ok2:#f2fff9; --vg:#f1fff9; --gd:#fffbe6; --md:#fff0e7;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:'Tajawal',sans-serif}
.page{max-width:1200px;margin:0 auto;padding:10px 14px}
a{color:#135; text-decoration:none} a:hover{text-decoration:underline}

/* HEADER โ ุดุนุงุฑ ููุท */
.header{
  width:100%; aspect-ratio:7/1.6;
  background:linear-gradient(135deg,var(--shine1),var(--shine2));
  border-radius:16px; box-shadow:0 10px 28px rgba(0,0,0,.12);
  position:relative; overflow:hidden; margin:12px auto;
}
.header:after{
  content:""; position:absolute; inset:0;
  background:url('logo.png') center/contain no-repeat;
  opacity:1;
}

/* Buttons */
.controls{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;padding:6px}
.btn{background:var(--moe);color:#fff;border:0;border-radius:12px;padding:10px 16px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(11,126,136,.25)}
.btn.light{background:#eef6f7;color:#06353b}
.btn.ghost{background:#fff;color:var(--moe);border:1px solid #d7ecec}
.btn:hover{filter:brightness(.97)}

/* Grid cards */
.grid{display:grid;grid-template-columns:repeat(4,minmax(260px,1fr));gap:16px}
@media (max-width:1150px){.grid{grid-template-columns:repeat(3,minmax(260px,1fr))}}
@media (max-width:900px){.grid{grid-template-columns:repeat(2,minmax(260px,1fr))}}
@media (max-width:620px){.grid{grid-template-columns:1fr}}

.card{
  background:linear-gradient(180deg,#ffffff 0%, #f9feff 100%);
  border-radius:16px; padding:14px; position:relative;
  box-shadow:0 10px 24px rgba(0,0,0,.08), inset 0 0 0 1px #e6efef;
}
.card h2{margin:0 0 6px;color:var(--moe);font-size:20px}
.kpi{display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px}
.progress{height:10px;background:#e6efef;border-radius:999px;overflow:hidden;margin:8px 0}
.bar{height:100%;background:#2aa897}
.badge{padding:2px 8px;border-radius:999px;background:#eaf6f6;color:#246;font-size:12px}

/* Center buttons under donut */
.centerBar{display:flex;gap:8px;justify-content:center;align-items:center;margin:8px 0}

/* Detail section */
.detail{display:none;margin-top:10px;border-top:1px dashed #e1ecec;padding-top:10px}
.subgrid{display:grid;grid-template-columns:repeat(2,minmax(160px,1fr));gap:8px}
.subCard{background:#f7fbfb;border:1px solid #e6efef;border-radius:12px;padding:10px}
.small{font-size:12px;color:#567}

/* Tables */
.tableWrap{margin-top:10px}
table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden}
thead th{background:#0f6f79;color:#fff;padding:10px;font-weight:700}
tbody td{padding:10px;border-bottom:1px solid #eef3f3;vertical-align:top}
tbody tr:last-child td{border-bottom:0}

/* Row coloring by level */
.row-excellent{background:var(--ok)}
.row-high{background:var(--ok2)}
.row-verygood{background:var(--vg)}
.row-good{background:var(--gd)}
.row-medium{background:var(--md)}
.level{font-weight:700}

/* Evidence modal */
.modal{position:fixed;inset:0;background:rgba(2,52,59,.6);backdrop-filter:blur(2px);display:none;align-items:center;justify-content:center;z-index:9999}
.sheet{width:min(920px,96vw);max-height:92vh;overflow:auto;background:#fff;border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.35);padding:16px}
.sheet h4{margin:0 0 8px}
.row{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.row label{font-size:12px;color:#345}
input[type=text],input[type=file],select{border:1px solid #d7e7e7;border-radius:8px;padding:8px;width:100%}
.sheet .close{position:sticky;top:0;margin-bottom:8px;background:#e8eff0;border:0;color:#034;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:700}

/* Print A4 window */
@media print{ .no-print{display:none !important} }

.footer{padding:18px 10px;text-align:center;color:#7a9aa0}
</style>
</head>
<body>
<div class="page">

  <!-- Header -->
  <div class="header" aria-label="ูุฒุงุฑุฉ ุงูุชุนููู โ ุดุนุงุฑ"></div>

  <!-- Top controls -->
  <div class="controls">
    <button class="btn" id="btnAnalyze">ุชุญููู ุดุงูู ๐</button>
    <button class="btn" id="btnFullReport">ุงูุชูุฑูุฑ ุงูุดุงูู PDF ๐</button>
    <button class="btn" id="btnFullPlan">ุงูุฎุทุฉ ุงูุดุงููุฉ PDF ๐๏ธ</button>
  </div>

  <!-- Domains grid -->
  <div id="dashboard" class="grid"></div>

  <div class="footer">ยฉ 1447 ูู โ ุซุงูููุฉ ุงููุนููุจู โ ููุตุฉ ุงูุชุญููู ูุงูุชุญุณูู ุงููุฏุฑุณู</div>
</div>

<!-- Evidence Modal -->
<div class="modal" id="eviModal" aria-hidden="true">
  <div class="sheet">
    <button class="close" id="eviClose">โ ุฅุบูุงู</button>
    <h4>ุฅุถุงูุฉ ุดุงูุฏ</h4>
    <div class="row" style="margin-bottom:8px">
      <div><label>ุงุณู/ูุตู ุงูุดุงูุฏ</label><input id="eviText" type="text" placeholder="ูุซุงู: ุชูุฑูุฑ ุฒูุงุฑุฉ ูุดุฑู .."/></div>
      <div><label>ุงููุตู ุงูุฏุฑุงุณู</label>
        <!-- ููุท ุงูุฃูู ูุงูุซุงูู -->
        <select id="eviTerm"><option>ุงูุฃูู</option><option>ุงูุซุงูู</option></select>
      </div>
      <div><label>ุงูุฃุณุจูุน (ูุฌุฑู)</label><select id="eviWeek"></select></div>
      <div><label>ุงูุชุงุฑูุฎ (ูุฌุฑู ุฃู ุงููุฑู)</label><input id="eviHijri" type="text" placeholder="1447/03/01"/></div>
    </div>
    <div class="row">
      <div><label>ุฑูุน ููู (PDF/ุตูุฑุฉ)</label><input id="eviFile" type="file" accept="application/pdf,image/*"/></div>
      <div style="grid-column:span 3"><label>ูุชุจุน</label><input id="eviOwner" type="text" disabled/></div>
    </div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button class="btn" id="eviSave">ุญูุธ ุงูุดุงูุฏ</button>
      <button class="btn light" id="eviCancel">ุฅูุบุงุก</button>
    </div>
    <div class="small" style="margin-top:6px">* ุงูุดูุงูุฏ ุชูุณุญุจ ุชููุงุฆูุงู ููุชูุงุฑูุฑ ูุฎุทุท ุงูุชุญุณูู. ูููู ูุชุญ ุงูููู ูู ูุงูุฐุฉ ููุจุซูุฉ ููุทุจุงุนุฉ.</div>
  </div>
</div>

<script>
/* ====== ุฅุนุฏุงุฏ Supabase (ุงููุฃ ุงูููู ูุชูุนูู ุงูุณุญุงุจุฉ) ====== */
const SB_URL  = ""; // ูุซุงู: "https://YOUR-PROJECT.supabase.co"
const SB_ANON = ""; // ูุซุงู: "YOUR-ANON-KEY"
const sb = (SB_URL && SB_ANON && window.supabase) ? window.supabase.createClient(SB_URL, SB_ANON) : null;

/* ====== ูุญููู ุจูุงูุงุช ููุญูุฏ (ุณุญุงุจู/ูุญูู) ====== */
const Data = (() => {
  const USE_SUPABASE = !!sb;            // ูุชูุนูู ุชููุงุฆููุง ุฅู ููุถุนุช ุงูููุงุชูุญ
  const STORE='yaqoubi_evidence_1447';  // ููุชุฎุฒูู ุงููุญูู
  const L = {
    async list(field_key,row_index){
      const mem = JSON.parse(localStorage.getItem(STORE)||'{}');
      return mem[`${field_key}::${row_index}`] || [];
    },
    async add(field_key,row_index,payload){
      const mem = JSON.parse(localStorage.getItem(STORE)||'{}');
      const k=`${field_key}::${row_index}`;
      mem[k]=mem[k]||[];
      mem[k].push({...payload, ts:Date.now()});
      localStorage.setItem(STORE, JSON.stringify(mem));
      return true;
    }
  };
  const S = {
    async list(field_key,row_index){
      const { data, error } = await sb.from('evidences')
        .select('*')
        .eq('school_id','yaqoubi')
        .eq('field_key', field_key)
        .eq('row_index', row_index)
        .order('created_at', { ascending: true });
      if (error) throw error;
      return (data||[]).map(r=>({ text:r.text, term:r.term, week:r.week_hijri, hijri:r.date_hijri, url:r.file_url, file_type:r.file_type, ts: new Date(r.created_at).getTime() }));
    },
    async add(field_key,row_index,payload){
      let file_url='', file_type='';
      if(payload.file){
        const ext = payload.file.name.split('.').pop();
        const path = `yaqoubi/${crypto.randomUUID()}.${ext}`;
        const up = await sb.storage.from('evidence').upload(path, payload.file, { upsert:false });
        if (up.error) throw up.error;
        const pub = sb.storage.from('evidence').getPublicUrl(path);
        file_url = pub.data.publicUrl; file_type = payload.file.type || '';
      }
      const ins = await sb.from('evidences').insert([{
        school_id:'yaqoubi', field_key, row_index,
        text: payload.text||null, term: payload.term||null,
        week_hijri: payload.week||null, date_hijri: payload.hijri||null,
        file_url, file_type
      }]);
      if (ins.error) throw ins.error;
      return true;
    }
  };
  return {
    listEvidences: (f,i)=> (USE_SUPABASE? S.list(f,i): L.list(f,i)),
    addEvidence : (f,i,p)=> (USE_SUPABASE? S.add(f,i,p):  L.add(f,i,p)),
  };
})();

/* ====== ุฃุณุงุจูุน ูุฌุฑู (ุนููุงุช โ ูููู ุชูุณุนุชูุง ูุงุญููุง) ====== */
const WEEKS=[
  {id:'1447/02/18',name:'ุนูุฏุฉ ุงูููุฆุฉ ุงูุฅุฏุงุฑูุฉ โ 1447/02/18'},
  {id:'1447/02/23',name:'ุนูุฏุฉ ุงููุนูููู โ 1447/02/23'},
  {id:'1447/03/01',name:'ุจุฏุงูุฉ ุงูุนุงู ุงูุฏุฑุงุณู โ 1447/03/01'},
  {id:'1447/04/01',name:'ุฅุฌุงุฒุฉ ุงูููู ุงููุทูู โ 1447/04/01'},
  {id:'1447/05/30',name:'ุฅุฌุงุฒุฉ ุงูุฎุฑูู (ุจุฏุงูุฉ) โ 1447/05/30'},
  {id:'1447/06/08',name:'ุฅุฌุงุฒุฉ ุงูุฎุฑูู (ููุงูุฉ) โ 1447/06/08'}
];
const eviWeekSel=document.getElementById('eviWeek');
WEEKS.forEach(w=>{const o=document.createElement('option');o.value=w.id;o.textContent=w.name;eviWeekSel.appendChild(o);});

/* ====== ุฃุฏูุงุช ูุณุงุนุฏุฉ ====== */
const fmt=v=>Number(v).toFixed(2);
function levelBadge(v){ if(v>=90)return {txt:'ููุชุงุฒ',color:'#10b981'}; if(v>=85)return {txt:'ูุฑุชูุน',color:'#22b8a0'}; if(v>=80)return {txt:'ุฌูุฏ ุฌุฏูุง',color:'#33c2a9'}; if(v>=75)return {txt:'ุฌูุฏ',color:'#f59e0b'}; return {txt:'ูุชูุณุท',color:'#f97316'}; }
function mapLevelClass(arLevel){
  if(arLevel==='ูุชููุฒ'||arLevel==='ูุฑุชูุน') return 'row-excellent';
  if(arLevel==='ุฌูุฏ ุฌุฏูุง') return 'row-verygood';
  if(arLevel==='ุฌูุฏ') return 'row-good';
  return 'row-medium';
}
function todayHijri(){
  try{
    const fmtHijri=new Intl.DateTimeFormat('ar-SA-u-ca-islamic',{year:'numeric',month:'2-digit',day:'2-digit',weekday:'long'});
    return fmtHijri.format(new Date());
  }catch(e){ return '1447/.. /..'; }
}

/* ====== ุจูุงูุงุช ุนููุง ูููุฌุงูุงุช ====== */
const fields={
  management:{ name:'ุงูุฅุฏุงุฑุฉ ุงููุฏุฑุณูุฉ', v2024:75.50, v2025:75.50, subs:[
    {id:'plans', name:'ุงูุชุฎุทูุท', v:54.00},
    {id:'lead', name:'ููุงุฏุฉ ุงูุนูููุฉ ุงูุชุนููููุฉ', v:72.75},
    {id:'soc', name:'ุงููุฌุชูุน ุงููุฏุฑุณู', v:57.25},
    {id:'dev', name:'ุงูุชุทููุฑ ุงููุคุณุณู', v:60.25}
  ]},
  teaching:{ name:'ุงูุชุนููู ูุงูุชุนููู', v2024:80.75, v2025:81.50, subs:[
    {id:'assess', name:'ุชูููู ุงูุชุนููู', v:82.75},
    {id:'exp', name:'ุจูุงุก ุฎุจุฑุงุช ุงูุชุนููู', v:76.75}
  ]},
  learning:{ name:'ููุงุชุฌ ุงูุชุนููู', v2024:78.50, v2025:78.50, subs:[
    {id:'ach', name:'ุงูุชุญุตูู ุงูุชุนูููู', v:80.25},
    {id:'socdev', name:'ุงูุชุทูุฑ ุงูุดุฎุตู ูุงูุตุญู ูุงูุงุฌุชูุงุนู', v:86.25}
  ]},
  environment:{ name:'ุงูุจูุฆุฉ ุงููุฏุฑุณูุฉ', v2024:64.00, v2025:62.25, subs:[
    {id:'safety', name:'ุงูุฃูู ูุงูุณูุงูุฉ', v:79.00},
    {id:'building', name:'ุงููุจูู ุงููุฏุฑุณู', v:71.50}
  ]}
};

/* ====== ุงูุฌุฏุงูู ุงูุชูุตูููุฉ (ููุง ุทูุจุช) ====== */
const detailed={
  management:[
    {level:'ูุชููุฒ', perf:94.50, indicator:'ุชูุดุฑ ุงููุฏุฑุณุฉ ููุงุนุฏ ุงูุณููู ูุงูููุงุธุจุฉ ูุชุชุงุจุน ุชุทุจูููุง ุจุงูุชุธุงู.', improve:'ูุดุฑ ุงูููุงุนุฏ ุฑููููุง ูุฑุจุทูุง ุจูุชุงุจุนุฉ ุฃุณุจูุนูุฉ ููุงูุถุจุงุท.', evidence:'ููุญุงุช ุงูุณูููุ ุชูุงุฑูุฑ ุงูุงูุถุจุงุทุ ุณุฌูุงุช ุฅุดุนุงุฑุงุช.'},
    {level:'ูุฑุชูุน', perf:90.25, indicator:'ุชููุฆุฉ ูุตูุงูุฉ ูุฑุงูู ุงููุจูู ูุชุฌููุฒุงุชู.', improve:'ูุธุงู ุตูุงูุฉ ุฑููู ูุชูุซูู ุจุงูุตูุฑ ูุงูุชูุงุฑูุฑ.', evidence:'ุฃูุงูุฑ ุนููุ ุตูุฑ ูุจู/ุจุนุฏุ ูุญุงุถุฑ ุฅูุฌุงุฒ.'},
    {level:'ูุฑุชูุน', perf:89.25, indicator:'ููุงุฎ ุขูู ููุญููุฒ ููุชุนููู ูุงูููู.', improve:'ุจุฑุงูุฌ ุฏุนู ููุณู ูููุงุณ ุฑุถุง ุงููุณุชููุฏูู ุฏูุฑููุง.', evidence:'ุงุณุชุจุงูุงุช ุฑุถุงุ ุณุฌูุงุช ุฅุฑุดุงุฏุ ุฎุทุท ููุงุฆูุฉ.'},
    {level:'ุฌูุฏ ุฌุฏูุง', perf:87.00, indicator:'ูุชุงุจุนุฉ ุฃุฏุงุก ุงูุนุงูููู ูุฏุนู ุงูุชุทููุฑ ุงููููู.', improve:'ุฎุทุท ุชุทููุฑ ูุฑุฏูุฉ ูุจููุฉ ุนูู ุชูููู ุณููู.', evidence:'ููุงุฐุฌ ุชููููุ ุฎุทุท ุชุญุณููุ ูุญุงุถุฑ ุชุบุฐูุฉ ุฑุงุฌุนุฉ.'},
    {level:'ุฌูุฏ ุฌุฏูุง', perf:85.25, indicator:'ูุชุงุจุนุฉ ุชูููุฐ ุงูุฎุทุฉ ุงูุชุดุบูููุฉ ูุชุทููุฑูุง.', improve:'ููุญุฉ ูุคุดุฑุงุช ุฃุณุจูุนูุฉ ูุฑุจุท ุงูููุงู ุจุงููุฎุฑุฌุงุช.', evidence:'ููุญุฉ ุฃุฏุงุกุ ุชูุงุฑูุฑ ุชูุฏูุ ูุญุงุถุฑ ูุฑู ุงูุนูู.'},
    {level:'ุฌูุฏ ุฌุฏูุง', perf:83.75, indicator:'ุชูุงุตู ูุนูุงู ูุน ุฃูููุงุก ุงูุฃููุฑ ูุงููุฌุชูุน.', improve:'ูููุงุช ุชูุงุตู ููุญูุฏุฉ ูุฌุฏููุฉ ููุงุกุงุช ุฏูุฑูุฉ.', evidence:'ููุตุฉ ุชูุงุตูุ ูุญุงุถุฑ ููุงุกุงุชุ ุชูุงุฑูุฑ ุชูุงุนู.'},
    {level:'ุฌูุฏ ุฌุฏูุง', perf:82.00, indicator:'ุชุดุฌูุน ุงูุญุตูู ุนูู ุงูุฑุฎุตุฉ ุงูููููุฉ.', improve:'ุจุฑูุงูุฌ ุชุญููุฒู ูุฌุฏููุฉ ุฏุฎูู ุงูุงุฎุชุจุงุฑุงุช.', evidence:'ููุงุฆู ุชุณุฌููุ ุดูุงุฏุงุช ุญุถูุฑุ ูุชุงุฆุฌ ุงูุฑุฎุตุฉ.'},
    {level:'ุฌูุฏ', perf:80.00, indicator:'ุชุนุฒูุฒ ุซูุงูุฉ ุงูุนูู ุงูุฌูุงุนู.', improve:'ูุฑู ุชูููุฒ ุจูููุงุช ูุงุถุญุฉ ููุชุงุจุนุฉ ุฅูุฌุงุฒ.', evidence:'ุชุดููู ุงููุฑูุ ุฎุทุท ูุฑูุ ุชูุงุฑูุฑ ูุฎุชุตุฑุฉ.'},
    {level:'ุฌูุฏ', perf:78.00, indicator:'ุชูุซูู ุงูููู ูุงููููุฉ ุงููุทููุฉ.', improve:'ููู ุฑููู ูููููุฉ ูุฑุชุจุท ุจุงูุฃูุดุทุฉ.', evidence:'ุตูุฑ ูุนุงููุงุชุ ูููุงุช ุฅูุฌุงุฒุ ููุงุฐุฌ ุชูุซูู.'},
    {level:'ุฌูุฏ', perf:76.50, indicator:'ุชูุนูู ูููุงุช ุงูุชูุงุตู ุงูุฏุงุฎูู.', improve:'ุชูุธูู ุงููุฑุงุณูุงุช ูุงูุงุฌุชูุงุนุงุช ุฅููุชุฑููููุง.', evidence:'ุณุฌูุงุช ุชุนูููุงุชุ ูุญุงุถุฑุ ููุงุฆุญ ุฅุฌุฑุงุกุงุช.'},
    {level:'ูุชูุณุท', perf:75.50, indicator:'ุชูุนูู ุงูุดุฑุงูุงุช ุงููุฌุชูุนูุฉ.', improve:'ุซูุงุซ ุดุฑุงูุงุช ููุนูุฉ ูุฑุชุจุทุฉ ุจุงูุชุนููู.', evidence:'ูุฐูุฑุงุช ุชูุงููุ ุชูุงุฑูุฑ ูุนุงููุงุชุ ุดูุงุฏุงุช ุดุฑุงูุฉ.'},
    {level:'ูุชูุณุท', perf:72.00, indicator:'ุชุทููุฑ ุฃูุธูุฉ ุงููุชุงุจุนุฉ ุงูุฅููุชุฑูููุฉ.', improve:'ููุญุฉ ูุคุดุฑุงุช ุฐููุฉ ูุชุญูููุงุช ุดูุฑูุฉ.', evidence:'ุชูุงุฑูุฑ ุชุญููููุฉุ ููุญุงุช ููุงุณุ ุฃุฑุดูู ุฑููู.'},
    {level:'ูุชูุณุท', perf:70.25, indicator:'ุชูุธูู ุงูุชูููุฉ ูู ุงูุฅุฏุงุฑุฉ ุงูููููุฉ.', improve:'ุฑูุน ุงุณุชุฎุฏุงู (ููุฑ/ูุงุฑุณ/ูุฏุฑุณุชู) ูุชุชุจุน ุงูุชูุงุฑูุฑ.', evidence:'ุณุฌูุงุช ุฏุฎููุ ุชูุงุฑูุฑ ุงุณุชุฎุฏุงูุ ูุตูููุฉ ุงูุชุฒุงู.'}
  ],
  teaching:[
    {level:'ูุชููุฒ', perf:99.25, indicator:'ุชูููุฐ ุงููุฏุฑุณุฉ ุจุฑุงูุฌ ุชุฏุฑูุจูุฉ ููุนูุฉ ูููุนูููู ุชูุทููุฑ ุงูููุงุฑุงุช ุงูุตูููุฉ.', improve:'ููุงุกูุฉ ุงูุชุฏุฑูุจ ูุน ุงูุงุญุชูุงุฌุงุช ุงููุนููุฉ ูุชุชุจุน ุฃุซุฑู ุฏุงุฎู ุงูุญุตุต.', evidence:'ุฎุทุท ุชุฏุฑูุจุ ุชูุงุฑูุฑ ุฃุซุฑุ ุงุณุชูุงุฑุงุช ูุชุงุจุนุฉ.'},
    {level:'ูุชููุฒ', perf:97.75, indicator:'ุชููุฆุฉ ุจูุฆุฉ ุชุนููููุฉ ูุญููุฒุฉ ูุชูููุฉ ุงูุชูููุฑ ุงูุฅุจุฏุงุนู/ุงููุงูุฏ.', improve:'ุชุถููู ููุงุฑุงุช ุงูุชูููุฑ ุงูุนููุง ูู ุงูุฎุทุท ุงูููููุฉ ูุงูุชุนูู ุงููุดุท.', evidence:'ุฎุทุท ุฏุฑูุณุ ููุงุญุธุงุช ุตููุฉุ ููุชุฌุงุช ุทูุงุจูุฉ.'},
    {level:'ูุชููุฒ', perf:97.50, indicator:'ุชูููุฉ ููุงุฑุงุช ุงูุชุนููู ุงูุฐุงุชู ูุงูุจุญุซ ูุฏู ุงููุชุนูููู.', improve:'ูุดุงุฑูุน ุจุญุซ ุฑูููุฉ ูุชุฏุฑูุจ ุนูู ูุตุงุฏุฑ ุงููุนูููุงุช ูุงูุชุญููู.', evidence:'ุจุญูุซ ุทูุงุจูุฉุ ุชูุซูู ุฅุดุฑุงููุ ููุตุงุช ูุดุงุฑูุฉ.'},
    {level:'ูุฑุชูุน', perf:96.75, indicator:'ุชุทุจูู ุงุณุชุฑุงุชูุฌูุงุช ุชุฏุฑูุณ ุญุฏูุซุฉ ุฏุงุนูุฉ ูููุงุฑุงุช ุงููุฑู 21.', improve:'ุชูุซูู ุงูุชุทุจูู ุนุจุฑ ุฒูุงุฑุงุช ุตููุฉ ูุชุนููู ูุธูุฑ ููุธูุฑ.', evidence:'ุชูุงุฑูุฑ ุฒูุงุฑุงุชุ ุชุณุฌููุงุช ูุตูุฑุฉุ ุงุณุชูุงุฑุงุช ุฃุฏุงุก.'},
    {level:'ูุฑุชูุน', perf:94.75, indicator:'ุชูููุฑ ูุณุงุฆู ุชุนููููุฉ ุฑูููุฉ ูุชููุนุฉ ุชุฏุนู ุงูุชุนููู ุงููุนูุงู.', improve:'ุฅูุชุงุฌ ูุญุชูู ุฑููู ุชูุงุนูู ูุชุฏุฑูุจ ุนูู ุชูุธููู.', evidence:'ูููุงุช ุฏุฑูุณ ุฑูููุฉุ ููุงุฐุฌ ุชูุธูู ุชูููุฉ.'},
    {level:'ูุฑุชูุน', perf:93.25, indicator:'ุชูููุน ุฃุฏูุงุช ุงูุชูููู ูููุงุณ ููุงุชุฌ ุงูุชุนููู.', improve:'ุชุญููู ุฃุณุจูุนู ูููุชุงุฆุฌ ูุฑุจุทูุง ุจุฎุทุท ุนูุงุฌ/ุฅุซุฑุงุก ุตูููุฉ.', evidence:'ุณุฌูุงุช ุชุญูููุ ุฎุทุท ุนูุงุฌูุฉุ ุฃุฏูุงุช ุชูููู.'},
    {level:'ุฌูุฏ ุฌุฏูุง', perf:91.75, indicator:'ุชูุฏูู ุชุบุฐูุฉ ุฑุงุฌุนุฉ ุจููุงุกุฉ ูุชุญุณูู ุฃุฏุงุก ุงูุทูุงุจ.', improve:'ูููุฐุฌ ููุญูุฏ ููุชุบุฐูุฉ ุงูุฑุงุฌุนุฉ ูุฃูุดุทุฉ ุชุตุญูุญูุฉ ูุงุญูุฉ.', evidence:'ููุงุฐุฌ ุชุบุฐูุฉ ุฑุงุฌุนุฉุ ุณุฌูุงุช ูุชุงุจุนุฉ.'},
    {level:'ุฌูุฏ ุฌุฏูุง', perf:89.50, indicator:'ุชูุธูู ุงูุชูููุฉ ุจูุงุนููุฉ ูู ุงูุชุนููู ูุงูุชุนููู.', improve:'ุชูุนูู ุฃุฏูุงุช ุงูุชูุงุนู (ุงุฎุชุจุงุฑุงุช ูุตูุฑุฉ/ููุงุฐุฌ/ููุตุงุช) ุจุงูุญุตุฉ.', evidence:'ุชูุงุฑูุฑ ยซูุฏุฑุณุชูยปุ ุฃุฏูุฉ ุฃูุดุทุฉ ุฑูููุฉ.'},
    {level:'ุฌูุฏ', perf:88.00, indicator:'ุฅุชุงุญุฉ ุชุนููู ุชุนุงููู ููุดุงุฑูุน ุฌูุงุนูุฉ.', improve:'ุชุตููู rubrics ูููุดุงุฑูุน ูุชูููู ุงูุฃุฏูุงุฑ ูุงููุฎุฑุฌุงุช.', evidence:'ูููุงุช ูุดุงุฑูุนุ ูุญุงุถุฑ ุชููููุ ุตูุฑ ุนุฑูุถ.'},
    {level:'ุฌูุฏ', perf:86.75, indicator:'ุชูููุฉ ููุงุฑุงุช ุงูุชูููุฑ ุงููุงูุฏ ูุฏู ุงููุชุนูููู.', improve:'ุฃูุดุทุฉ ุชุญููู ูููุงุด ููุธูู ูู ุงูุนููู ูุงููุบุฉ.', evidence:'ุฎุทุท ุฃูุดุทุฉุ ุชูุงุฑูุฑ ุฃุฏุงุกุ ุนููุงุช ุฃุนูุงู.'},
    {level:'ุฌูุฏ', perf:84.50, indicator:'ุจุฑุงูุฌ ุฅุซุฑุงุฆูุฉ ูููุชููุฒูู ูุงูููููุจูู.', improve:'ูุฑุด ุฃุณุจูุนูุฉ ุฅุซุฑุงุฆูุฉ ููุชุงุจุนุฉ ูุฎุฑุฌุงุชูู ุงูููุนูุฉ.', evidence:'ููุงุฆู ูุดุงุฑูููุ ููุชุฌุงุชุ ุชูุงุฑูุฑ ูููุจุฉ.'},
    {level:'ูุชูุณุท', perf:82.75, indicator:'ุจูุงุก ุงูุฏุฑูุณ ููู ููุงุชุฌ ุชุนูู ูุงุถุญุฉ ููุนูููุฉ.', improve:'ูุฑุงุฌุนุฉ ุงูุฎุทุท ุงูููููุฉ ูุถุจุท ูุคุดุฑุงุช ุงูุฅุชูุงู.', evidence:'ุฎุทุท ูุญุฏุซุฉุ ููุงุญุธุงุช ุฅุดุฑุงููุฉ.'},
    {level:'ูุชูุณุท', perf:76.75, indicator:'ุชูููุน ุฃุณุงููุจ ุงูุชุนููู ุจูุง ููุงุฆู ุงููุฑูู ุงููุฑุฏูุฉ.', improve:'ุฃูุดุทุฉ ูุชุนุฏุฏุฉ ุงูุฃููุงุท (ุจุตุฑู/ุณูุนู/ุญุณู) ุฏุงุฎู ุงูุญุตุฉ.', evidence:'ุฎุทุท ูุนุฏููุฉุ ุชูุงุฑูุฑ ุตููุฉุ ุชุญููู ูุชุงุฆุฌ.'}
  ],
  learning:[
    {level:'ูุชููุฒ', perf:96.75, indicator:'ูุธูุฑ ุงููุชุนูููู ุงุนุชุฒุงุฒูุง ุจุงูููู ูุงููููุฉ ุงููุทููุฉ.', improve:'ุฑุจุท ุงูุฃูุดุทุฉ ุงูุตููุฉ ูุงููุงุตููุฉ ุจุงูููู ุงููุทููุฉ ุนุจุฑ ููุตุงุช ุงููุฏุฑุณุฉ.', evidence:'ููุชุฌุงุช ุทูุงุจูุฉุ ุตูุฑ ูุนุงููุงุชุ ุชูุงุฑูุฑ ุงููููุฉ.'},
    {level:'ูุชููุฒ', perf:96.25, indicator:'ูุฏู ุงููุชุนูููู ุงุชุฌุงูุงุช ุฅูุฌุงุจูุฉ ูุฏุงูุนูุฉ ูุฑุชูุนุฉ ููุชุนููู.', improve:'ุจุฑุงูุฌ ุชุญููุฒูุฉ ูููุฌูุฉ ูุชูุณูุฑ ุงูุฅุฑุดุงุฏ ุงูุฃูุงุฏููู ูุชุนุฒูุฒ ุงูุงุณุชูุฑุงุฑ.', evidence:'ุงุณุชุจุงูุงุช ุฑุถุงุ ุฎุทุท ุฅุฑุดุงุฏุ ุชูุงุฑูุฑ ูุชุงุจุนุฉ.'},
    {level:'ูุชููุฒ', perf:95.50, indicator:'ูุชุงุฆุฌ ูุชููุฒุฉ ูู ุงูุงุฎุชุจุงุฑุงุช ุงููุทููุฉ/ุงูุฏูููุฉ.', improve:'ุงุฎุชุจุงุฑุงุช ูุนูุงุฑูุฉ ุฏูุฑูุฉ ูุฎุทุท ุนูุงุฌูุฉ ูููุงูุฏ ุงูุชุนููู.', evidence:'ูุชุงุฆุฌ ุงุฎุชุจุงุฑุงุชุ ุชุญูููุงุชุ ุฎุทุท ุนูุงุฌ.'},
    {level:'ูุชููุฒ', perf:94.00, indicator:'ุงูุชุฒุงู ุจููุงุนุฏ ุงูุณููู ูุงูุงูุถุจุงุท ุงููุฏุฑุณู.', improve:'ูุชุงุจุนุฉ ููููุฉ ููุงูุถุจุงุท ูุชูุฑูู ุณูููู ุฏูุฑู.', evidence:'ุณุฌูุงุช ุงูุงูุถุจุงุทุ ูุญุงุถุฑ ุชูุฑููุ ุชูุงุฑูุฑ ูุชุงุจุนุฉ.'},
    {level:'ุฌูุฏ ุฌุฏูุง', perf:91.75, indicator:'ุงุชุฌุงูุงุช ุฅูุฌุงุจูุฉ ูุญู ุงูุฐุงุช ูุงูููู ุงูุดุฎุตู.', improve:'ุจุฑุงูุฌ ููุงุฑูุฉ ยซุฃูุง ุฃุณุชุทูุนยป ููุณุงุฑุงุช ููุงุฏุฉ ุทูุงุจูุฉ.', evidence:'ููุงุฆู ูุดุงุฑูุฉุ ุชูุงุฑูุฑ ุจุฑุงูุฌุ ุงุณุชุจุงูุงุช ุฃุซุฑ.'},
    {level:'ุฌูุฏ ุฌุฏูุง', perf:89.25, indicator:'ููุงุฑุงุช ุงูุจุญุซ ูุงูุชุนููู ุงูุฐุงุชู.', improve:'ูุดุงุฑูุน ุจุญุซ ุฑูููุฉ ูุชุฏุฑูุจ ุนูู ุงูุชูุซูู ุงูุนููู.', evidence:'ุจุญูุซ ุทูุงุจูุฉุ ููุงุฐุฌ ุชููููุ ููุตุฉ ูุดุงุฑูุฉ.'},
    {level:'ุฌูุฏ ุฌุฏูุง', perf:86.25, indicator:'ููุงุฑุงุช ุงุฌุชูุงุนูุฉ ูุตุญูุฉ ุฅูุฌุงุจูุฉ.', improve:'ุญููุงุช ุชูุนููุฉ ูููุงุฑุณุงุช ุตุญูุฉ ุฏุงุฎู ุงููุฏุฑุณุฉ.', evidence:'ูุดุฑุงุชุ ุตูุฑ ูุนุงููุงุชุ ุชูุงุฑูุฑ ูุดุงุท.'},
    {level:'ุฌูุฏ', perf:84.25, indicator:'ูุดุงุฑูุฉ ูู ูุจุงุฏุฑุงุช ูุฌุชูุนูุฉ ูุฎุฏูุฉ ุนุงูุฉ.', improve:'ุดุฑุงูุงุช ููุนูุฉ ููุจุงุฏุฑุงุช ุทูุงุจูุฉ ููุซููุฉ.', evidence:'ูุฐูุฑุงุช ุชุนุงููุ ุชูุงุฑูุฑ ูุจุงุฏุฑุงุชุ ุตูุฑ.'},
    {level:'ุฌูุฏ', perf:82.94, indicator:'ุชูุฏู ูู ูุชุงุฆุฌ ุงูููุงุฏ ุงูุฏุฑุงุณูุฉ.', improve:'ุชุญููู ูุชุงุฆุฌ ุงูููุงุฏ ูุจูุงุก ุฎุทุท ุฏุนู ูููุตูู ุงูุฃูู ุฃุฏุงุกู.', evidence:'ุชูุงุฑูุฑ ุชุญูููุ ุฎุทุท ุฑูุนุ ูุชุงุจุนุฉ ุฅุดุฑุงููุฉ.'},
    {level:'ุฌูุฏ', perf:79.04, indicator:'ุชุญูู ููุงุชุฌ ุชุนูู ูู ุงูููุงุฏ ุงูุฃุณุงุณูุฉ.', improve:'ุชูููู ูุณุชูุฑ ูุฑุจุท ูุชุงุฆุฌู ุจุฎุทุท ุชุญุณูู ุตููุฉ.', evidence:'ุฃุฏูุงุช ุชููููุ ุณุฌูุงุช ุชุญูููุ ุฎุทุท ุนูุงุฌ.'},
    {level:'ูุชูุณุท', perf:63.25, indicator:'ูุดุงุฑูุฉ ุซูุงููุฉ/ููููุฉ (ูุณุงุจูุงุช ูุจุฑุงูุฌ ูุฌุชูุนูุฉ).', improve:'ุชุญููุฒ ุงููุดุงุฑูุฉ ูู ุงููุณุงุจูุงุช ุงูุซูุงููุฉ ูุจุฑุงูุฌ ุงูููู.', evidence:'ุตูุฑ ูุนุงููุงุชุ ุชูุงุฑูุฑ ุฃูุดุทุฉุ ูุดุฑุงุช ูุฏุฑุณูุฉ.'}
  ],
  environment:[
    {level:'ูุชููุฒ', perf:97.50, indicator:'ุชุนูู ุงููุฏุฑุณุฉ ุนูู ุชููุฆุฉ ูุตูุงูุฉ ูุฑุงูู ุงููุจูู ูุชุฌููุฒุงุชู ุจุงูุชุธุงู.', improve:'ุณุฌู ุฑููู ููุตูุงูุฉ ุงูููุงุฆูุฉ ูุชุญุฏูุซ ุฎุทุฉ ุงูุตูุงูุฉ ุงูุฏูุฑูุฉ.', evidence:'ุชูุงุฑูุฑ ุตูุงูุฉุ ุตูุฑ ุฃุนูุงูุ ูุญุงุถุฑ ุฅูุฌุงุฒ.'},
    {level:'ูุชููุฒ', perf:97.00, indicator:'ุงููุญุงูุธุฉ ุนูู ูุธุงูุฉ ุงููุจูู ูุงููุฑุงูู ุจุตูุฑุฉ ูุณุชูุฑุฉ.', improve:'ุชุนุฒูุฒ ุงูุฅุดุฑุงู ุงููููู ูุชุญุฏูุฏ ูุณุคูู ูุชุงุจุนุฉ ูููุธุงูุฉ.', evidence:'ุชูุงุฑูุฑ ุฅุดุฑุงููุฉุ ุตูุฑ ุชูุซููุ ุนููุฏ ูุชุงุจุนุฉ.'},
    {level:'ุฌูุฏ ุฌุฏูุง', perf:94.00, indicator:'ุชูุงูุฑ ูุนุงููุฑ ุงูุฃูู ูุงูุณูุงูุฉ ูุชุทุจูููุง ุจุงูุชุธุงู.', improve:'ุชูููุฐ ูุฑุถูุงุช ุฏูุฑูุฉ ูุชุญุฏูุซ ุฃุฏูุงุช ุงูุณูุงูุฉ ููู ุงูููุงุฆุญ.', evidence:'ุณุฌูุงุช ุงูุฃูู ูุงูุณูุงูุฉุ ุตูุฑ ุงููุฑุถูุงุชุ ุชูุงุฑูุฑ ูุชุงุจุนุฉ.'},
    {level:'ุฌูุฏ ุฌุฏูุง', perf:79.00, indicator:'ุชูุงูุฑ ูุตููุงุช ุขููุฉ ููุนูููุฉ ุงูุชุนููููุฉ ุชููููู ูู ุญุฑูุฉ ููุณูุฑุฉ.', improve:'ุชููุฆุฉ ุงูููุฑุงุช ูุงููุฑุงูู ูุฏุนู ุฐูู ุงูุฅุนุงูุฉ.', evidence:'ุตูุฑ ุชุฌููุฒุงุชุ ุชูุงุฑูุฑ ุฅุดุฑุงููุฉุ ูุญุงุถุฑ ูุชุงุจุนุฉ.'},
    {level:'ุฌูุฏ', perf:73.25, indicator:'ุงูุจูุฆุฉ ุงููุฏุฑุณูุฉ ูุชูุณุทุฉ ุงูุฌุงุฐุจูุฉ ูููุชุนูููู.', improve:'ุชุทููุฑ ุงูุจูุฆุฉ ุงูุตููุฉ ุจุงูุฃููุงู ุงูุชุนููููุฉ ูุงูุฌูุณุงุช ุงูุชูุงุนููุฉ.', evidence:'ุตูุฑ ุงููุตููุ ุงุณุชุจุงูุงุช ุฑุถุงุ ุชูุงุฑูุฑ ุฅุดุฑุงููุฉ.'},
    {level:'ูุชูุณุท', perf:64.00, indicator:'ูุฌูุฏ ููุงูุฐ ุขููุฉ ููุทูุงุฑุฆ ูุงุณุชููุงุก ูุชุทูุจุงุช ุงูุณูุงูุฉ.', improve:'ูุฑุงุฌุนุฉ ููุงูุน ุงููุฎุงุฑุฌ ูุชูุนูู ููุญุงุช ุงูุฅุฑุดุงุฏ ูุงูุฅุถุงุกุฉ ุงูุทุงุฑุฆุฉ.', evidence:'ุชูุงุฑูุฑ ุงูุฏูุงุน ุงููุฏููุ ุตูุฑ ุงููุฎุงุฑุฌุ ูุญุงุถุฑ ุชุญุฏูุซ.'},
    {level:'ูุชูุณุท', perf:62.50, indicator:'ููุงูุฉ ุงูุฅุถุงุกุฉ ูุงูุชูููุฉ ุจูุง ูุญูู ุจูุฆุฉ ุชุนููููุฉ ุตุญูุฉ.', improve:'ุชุญุณูู ุงูุฅุถุงุกุฉ ูุตูุงูุฉ ุฃุฌูุฒุฉ ุงูุชูููุฉ ุดูุฑููุง.', evidence:'ุชูุงุฑูุฑ ูููุฉุ ุตูุฑ ุตูุงูุฉุ ุชูุงุฑูุฑ ูุชุงุจุนุฉ.'}
  ]
};

/* ====== ูุชุญ ุชุจููุจ A4 ูุน ุฑุฃุณ ุตูุฑุฉ logo ููุท ====== */
function openDocWindow(title, contentHTML){
  const w=window.open('', '_blank'); if(!w){alert('ูุถูุงู ุงุณูุญ ุจุงูููุงูุฐ ุงูููุจุซูุฉ.');return;}
  const doc=`
  <!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"/>
  <title>${title}</title>
  <style>
    body{font-family:'Tajawal',sans-serif;margin:0;background:#fff;color:#06353b}
    .a4{width:210mm; min-height:297mm; margin:0 auto; background:#fff;}
    .header{width:100%; height:110px; background:#f2fbfb; position:relative; overflow:hidden}
    .header img{width:100%; height:100%; object-fit:cover; display:block}
    .pad{padding:14px 16px}
    h2{margin:8px 0;color:#0b7e88}
    h3{color:#0b7e88}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    thead th{background:#0f6f79;color:#fff;padding:8px}
    td,th{padding:8px;border:1px solid #e7eff0;vertical-align:top}
    .row-excellent{background:#e9fff4}.row-verygood{background:#f1fff9}.row-good{background:#fffbe6}.row-medium{background:#fff0e7}
    .toolbar{position:sticky;top:0;background:#fff;padding:8px 16px;margin:0;border-bottom:1px dashed #e1ecec;display:flex;gap:8px;justify-content:flex-start}
    .btn{padding:8px 12px;border:1px solid #0b7e88;border-radius:8px;background:#0b7e88;color:#fff;cursor:pointer}
    .meta{display:flex;justify-content:space-between;align-items:center;margin:8px 0 0 0;font-weight:700}
    @media print{.toolbar{display:none}}
  </style></head><body>
  <div class="toolbar no-print">
    <button class="btn" onclick="window.print()">ุทุจุงุนุฉ/ุญูุธ PDF</button>
    <button class="btn" onclick="window.close()">ุฅุบูุงู</button>
  </div>
  <div class="a4">
    <div class="header"><img src="logo.png" alt="Header"></div>
    <div class="pad">
      <div class="meta">
        <div style="text-align:right">${todayHijri()}</div>
        <div></div>
      </div>
      ${contentHTML}
    </div>
  </div>
  </body></html>`;
  w.document.open(); w.document.write(doc); w.document.close();
}

/* ====== ุนุงุฑุถ ุงูุดุงูุฏ ====== */
function openEvidenceViewer(url,title='ุดุงูุฏ'){
  const html = `<h2>${title}</h2>` + (url?.toLowerCase().endsWith('.pdf')?`<embed src="${url}" type="application/pdf" style="width:100%;height:80vh"/>`:`<img src="${url}" style="max-width:100%;height:auto"/>`);
  openDocWindow('ุดุงูุฏ', html);
}

/* ====== ููุญุฉ ุงููุฌุงูุงุช ====== */
function renderDashboard(){
  const dash=document.getElementById('dashboard'); dash.innerHTML='';
  Object.entries(fields).forEach(([key,f])=>{
    const lvl=levelBadge(f.v2025);
    const card=document.createElement('div'); card.className='card'; card.id=`card-${key}`;
    card.innerHTML=`
      <h2>${f.name}</h2>
      <div class="kpi"><span>2024: ${fmt(f.v2024)}% โ 2025: ${fmt(f.v2025)}%</span>
        <span class="badge" style="background:${lvl.color}22;color:${lvl.color}">${lvl.txt}</span></div>
      <div class="progress"><div class="bar" style="width:${Math.max(2,f.v2025)}%"></div></div>

      <div style="display:flex;justify-content:center"><canvas id="donut-${key}" height="130"></canvas></div>
      <div class="centerBar">
        <button class="btn ghost" onclick="openFieldReport('${key}')">ุชูุฑูุฑ ุงููุฌุงู PDF</button>
        <button class="btn ghost" onclick="openFieldPlan('${key}')">ุฎุทุฉ ุชุญุณูู ุงููุฌุงู PDF</button>
      </div>

      <div class="detail" id="detail-${key}"></div>
    `;
    // ูุชุญ ุงูุชูุงุตูู ุจููุฑุฉ ูู ุฃู ููุงู ุบูุฑ ุงูุฃุฒุฑุงุฑ/ุงููุงููุณ
    card.addEventListener('click', (e)=>{
      if(e.target.closest('button')||e.target.tagName==='CANVAS') return;
      toggleDetail(key);
    });
    dash.appendChild(card);

    // ุงูุฏููุช (ุตุบูุฑุฉ ุนูููุฉ ููุง ูู)
    new Chart(document.getElementById(`donut-${key}`).getContext('2d'),{
      type:'doughnut',
      data:{labels:f.subs.map(s=>s.name),datasets:[{data:f.subs.map(s=>s.v),backgroundColor:['#2aa897','#5d9ed6','#f1ad5b','#7ac6b7','#91a7ff','#a5d8a6']}]},
      options:{plugins:{legend:{display:false}},cutout:'70%'}
    });
  });
}

/* ====== ุชูุงุตูู ุงููุฌุงู (ุชุฌูุจ ุงูุดูุงูุฏ ูู Data) ====== */
async function toggleDetail(key){
  const dash=document.getElementById('dashboard');
  Array.from(dash.children).forEach(c=>{ if(c.id!==`card-${key}`) c.style.display='none'; });
  const box=document.getElementById(`detail-${key}`);
  const isOpen=box.style.display==='block';
  if(isOpen){ box.style.display='none'; Array.from(dash.children).forEach(c=>c.style.display=''); return; }

  const f=fields[key];
  const subsHtml=f.subs.map(s=>`
    <div class="subCard">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>${s.name}</strong>
        <span class="badge" style="background:${levelBadge(s.v).color}22;color:${levelBadge(s.v).color}">${fmt(s.v)}%</span>
      </div>
      <div class="small">ูุณุชูู ุงููุคุดุฑ ุงููุฑุนู ููุฐุง ุงููุฌุงู</div>
    </div>`).join('');

  // ุตููู ุงูุฌุฏูู ูุน ุงูุดูุงูุฏ (ูู Data)
  const det = detailed[key]||[];
  let rowsHTML='';
  for(let i=0;i<det.length;i++){
    const r=det[i];
    const evis = await Data.listEvidences(key,i);
    const evisHTML = evis.map((e,idx)=>`<div class="small">โข ${e.hijri||''} โ <a href="${e.url||'#'}" target="_blank" onclick="event.preventDefault();openEvidenceViewer('${e.url||'#'}','${(e.text||('ุดุงูุฏ '+(idx+1))).replace(/'/g,"&#39;")}');">${e.text||('ุดุงูุฏ '+(idx+1))}</a></div>`).join('');
    rowsHTML += `<tr class="${mapLevelClass(r.level)}">
      <td class="level">${r.level}<div class="small">${fmt(r.perf)}%</div></td>
      <td>${r.indicator}</td>
      <td>${r.improve}</td>
      <td>${r.evidence}${evisHTML?`<div style="margin-top:6px">${evisHTML}</div>`:''}
        <div style="margin-top:8px"><button class="btn light" onclick="openEvidence('${key}',${i})">ุฅุถุงูุฉ ุดุงูุฏ +</button></div>
      </td>
    </tr>`;
  }

  box.innerHTML=`
    <div class="subgrid">${subsHtml}</div>
    <div class="tableWrap">
      <table>
        <thead><tr><th>ุงููุณุชูู/ุงูุฃุฏุงุก</th><th>ุงููุคุดุฑ</th><th>ููุชุฑุญุงุช ุงูุชุญุณูู</th><th>ุงูุดูุงูุฏ</th></tr></thead>
        <tbody>${rowsHTML}</tbody>
      </table>
      <div style="display:flex;justify-content:flex-end;margin-top:10px">
        <button class="btn light" onclick="resetView()">ุฑุฌูุน ุฅูู ุฌููุน ุงููุฌุงูุงุช โฉ๏ธ</button>
      </div>
    </div>`;
  box.style.display='block';
}

/* ====== ุฑุฌูุน ููุดุจูุฉ ====== */
function resetView(){ const dash=document.getElementById('dashboard'); Array.from(dash.children).forEach(c=>c.style.display=''); document.querySelectorAll('.detail').forEach(d=>d.style.display='none'); }

/* ====== ุดูุงูุฏ (ูุงูุฐุฉ) ====== */
let currentEvi={key:'',idx:0};
function openEvidence(fieldKey,rowIdx){
  currentEvi={key:fieldKey,idx:rowIdx};
  document.getElementById('eviOwner').value=`${fields[fieldKey].name} โ ุจูุฏ ${rowIdx+1}`;
  document.getElementById('eviText').value='';
  document.getElementById('eviHijri').value=todayHijri().replace(/\s/g,'');
  document.getElementById('eviFile').value='';
  document.getElementById('eviTerm').value='ุงูุฃูู';
  document.getElementById('eviWeek').value=WEEKS[2].id;
  document.getElementById('eviModal').style.display='flex';
}
function closeEvidence(){ document.getElementById('eviModal').style.display='none'; }
document.getElementById('eviClose').onclick=closeEvidence;
document.getElementById('eviCancel').onclick=closeEvidence;

document.getElementById('eviSave').onclick=async ()=>{
  const text=document.getElementById('eviText').value.trim();
  const term=document.getElementById('eviTerm').value;
  const week=document.getElementById('eviWeek').value;
  const hijri=document.getElementById('eviHijri').value.trim()||todayHijri();
  const fileInput=document.getElementById('eviFile');
  const file=(fileInput.files&&fileInput.files[0])?fileInput.files[0]:null;

  if(!text && !file){ alert('ุฃุฏุฎู ุงุณู ุงูุดุงูุฏ ูุงุฑูุน ููููุง (ุงุฎุชูุงุฑู).'); return; }
  try{
    await Data.addEvidence(currentEvi.key, currentEvi.idx, {text,term,week,hijri,file});
    closeEvidence();
    // ุฃุนูุฏ ูุชุญ ุงูุชูุงุตูู ูุชูุนูุณ ุงูุฅุถุงูุฉ ููุฑูุง
    await toggleDetail(currentEvi.key); await toggleDetail(currentEvi.key);
  }catch(e){ alert('ุชุนุฐุฑ ุงูุญูุธ: '+(e.message||e)); }
};

/* ====== ุชูุงุฑูุฑ/ุฎุทุท ุงููุฌุงู (ูุญุชูู ููุง ูู) ====== */
function buildFieldReportHTML(key){
  const f=fields[key], lvl=levelBadge(f.v2025);
  const rows=(detailed[key]||[]).map(r=>`<tr class="${mapLevelClass(r.level)}"><td>${r.level}</td><td>${fmt(r.perf)}%</td><td>${r.indicator}</td><td>${r.improve}</td><td>${r.evidence}</td></tr>`).join('');
  return `
  <h2>ุชูุฑูุฑ ุงููุฌุงู: ${f.name}</h2>
  <div>ุงูุฃุฏุงุก 2024: ${fmt(f.v2024)}% โ ุงูุฃุฏุงุก 2025: ${fmt(f.v2025)}% โ ุงููุณุชูู: ${lvl.txt}</div>
  <table><thead><tr><th>ุงููุณุชูู</th><th>ูุณุจุฉ ุงูุฃุฏุงุก</th><th>ุงููุคุดุฑ</th><th>ููุชุฑุญุงุช ุงูุชุญุณูู</th><th>ุงูุดูุงูุฏ</th></tr></thead><tbody>${rows}</tbody></table>`;
}
function buildFieldPlanHTML(key){
  const f=fields[key];
  const rows=(detailed[key]||[]).slice(0,6).map(r=>`<tr><td>${r.indicator}</td><td>${r.improve}</td><td>${WEEKS[2].id}</td><td>${r.evidence}</td></tr>`).join('');
  return `<h2>ุฎุทุฉ ุชุญุณูู ุงููุฌุงู: ${f.name}</h2>
  <table><thead><tr><th>ุงููุฏู/ุงููุคุดุฑ</th><th>ุงูุฅุฌุฑุงุก ุงูุชุญุณููู</th><th>ุงููุฏุฉ (ุฃุณุจูุน ูุฌุฑู)</th><th>ุงูุดูุงูุฏ</th></tr></thead><tbody>${rows}</tbody></table>`;
}
function openFieldReport(key){ openDocWindow('ุชูุฑูุฑ ุงููุฌุงู', buildFieldReportHTML(key)); }
function openFieldPlan(key){ openDocWindow('ุฎุทุฉ ุชุญุณูู ุงููุฌุงู', buildFieldPlanHTML(key)); }

/* ====== ุงูุชูุฑูุฑ ุงูุดุงูู (ููุง ูู ูุณุฎุชู) ====== */
function buildComprehensiveReport(){
  return `
  <h2>๐ฉ ุงูุชูุฑูุฑ ุงูุดุงูู ูุฎุทุฉ ุงูุชุญุณูู ุงููุคุณุณู โ ุซุงูููุฉ ุงููุนููุจู ุจุงูุฎุจุฑ (1447ูู)</h2>
  <div><strong>ุฅุนุฏุงุฏ: ูุฏูุฑ ุงููุฏุฑุณุฉ / ููุฏ ุญุงูุฏ ุนูู ุงูุฒูุฑุงูู</strong></div>
  <h3>๐ฆ ุฃููุงู: ุงูููุฏูุฉ</h3>
  <p>ูู ุถูุก ุชูุฌูุงุช ูุฒุงุฑุฉ ุงูุชุนููู ูุญู ุฑูุน ููุงุกุฉ ุงูุฃุฏุงุก ุงููุฏุฑุณู ูุชุญููู ูุคุดุฑุงุช ุงูุชููุฒ ุงููุคุณุณูุ
  ุชู ุชุญููู ูุชุงุฆุฌ ุงูุชูููู ุงููุฏุฑุณู ุงูุฎุงุฑุฌู ูููุตููู ุงูุฏุฑุงุณููู ุงูุฃูู ูุงูุซุงูู ูุนุงู 1447ููุ
  ูุงูุชู ุดููุช ุฃุฑุจุนุฉ ูุฌุงูุงุช ุฑุฆูุณุฉ ูู: ุงูููุงุฏุฉ ูุงูุฅุฏุงุฑุฉ ุงููุฏุฑุณูุฉุ ุงูุชุนููู ูุงูุชุนูููุ ููุงุชุฌ ุงูุชุนูููุ ุงูุจูุฆุฉ ุงููุฏุฑุณูุฉ.
  ููุฏ ุจูููุช ูุฐู ุงูุฎุทุฉ ูุชููู ุชุญุณูููุฉ ููุงุจูุฉ ููููุงุณ ููู ูููุฐุฌ SMARTุ ุจูุง ูุณูู ูู ุฑูุน ุฌูุฏุฉ ุงููุฎุฑุฌุงุช ุงูุชุนููููุฉ ูุชุญููู ูุณุชูุฏูุงุช ุฑุคูุฉ ุงูููููุฉ 2030 ูู ุงูุชุนููู.</p>

  <h3>๐ฆ ุซุงูููุง: ููุฎุต ูุชุงุฆุฌ ุงูุชุญููู ุงูุนุงู</h3>
  <table>
    <thead><tr><th>ุงููุฌุงู</th><th>ูุชูุณุท ุงูุฃุฏุงุก</th><th>ูุณุชูู ุงูุฃุฏุงุก</th><th>ุฃุจุฑุฒ ููุงุท ุงูููุฉ</th><th>ุฃุจุฑุฒ ูุฑุต ุงูุชุญุณูู</th></tr></thead>
    <tbody>
      <tr class="row-verygood"><td>ุงูููุงุฏุฉ ูุงูุฅุฏุงุฑุฉ ุงููุฏุฑุณูุฉ</td><td>86%</td><td>ุฌูุฏ ุฌุฏูุง</td><td>ุฎุทุฉ ุชุดุบูููุฉ ูุนูุงูุฉ โ ุฑุฎุต ููููุฉ โ ูุชุงุจุนุฉ ููุฏุงููุฉ.</td><td>ุถุนู ุงูุชูุซูู ุงูุฑููู โ ูุญุฏูุฏูุฉ ุงูุดุฑุงูุงุช ุงููุฌุชูุนูุฉ.</td></tr>
      <tr class="row-verygood"><td>ุงูุชุนููู ูุงูุชุนููู</td><td>88%</td><td>ุฌูุฏ ุฌุฏูุง</td><td>ุจูุฆุฉ ุชุนูู ูุญูุฒุฉ โ ุงุณุชุฑุงุชูุฌูุงุช ุญุฏูุซุฉ โ ุชุบุฐูุฉ ุฑุงุฌุนุฉ ูุนุงูุฉ.</td><td>ุถุนู ุชูููุน ุงูุฃุณุงููุจ โ ุถุนู ุชูุธูู ุงูุชูููุฉ ูู ุจุนุถ ุงูููุงุฏ.</td></tr>
      <tr class="row-excellent"><td>ููุงุชุฌ ุงูุชุนููู</td><td>91%</td><td>ูุชููุฒ</td><td>ุงูุชุฒุงู ุณูููู โ ุงุนุชุฒุงุฒ ุจุงููููุฉ โ ุชุญุตูู ุฏุฑุงุณู ูุฑุชูุน.</td><td>ุชูุงูุช ุจูู ุงูููุงุฏ ุงูุฏุฑุงุณูุฉ โ ุถุนู ุงููุจุงุฏุฑุงุช ุงููุฌุชูุนูุฉ.</td></tr>
      <tr class="row-verygood"><td>ุงูุจูุฆุฉ ุงููุฏุฑุณูุฉ</td><td>84%</td><td>ุฌูุฏ ุฌุฏูุง</td><td>ูุฑุงูู ูููุฃุฉ โ ุชุทุจูู ูุนุงููุฑ ุงูุณูุงูุฉ โ ุจูุฆุฉ ูุธููุฉ.</td><td>ุถุนู ุชุฌููุฒ ูุฑุงูู ุฐูู ุงูุฅุนุงูุฉ ูุชุญุณูู ุงูุฅุถุงุกุฉ.</td></tr>
    </tbody>
  </table>

  <h3>๐ฆ ุซุงูุซูุง: ุฎุทุฉ ุงูุชุญุณูู ุงูุดุงููุฉ (SMART)</h3>
  <table>
    <thead><tr><th>ุงููุฌุงู</th><th>ุงููุฏู ุงูุนุงู</th><th>ุงูุฅุฌุฑุงุก ุงูุชูููุฐู</th><th>ุงููุฏุฉ ุงูุฒูููุฉ</th><th>ูุคุดุฑ ุงูููุงุณ</th><th>ุฌูุฉ ุงูุชูููุฐ ูุงููุชุงุจุนุฉ</th></tr></thead>
    <tbody>
      <tr class="row-verygood"><td>ุงูููุงุฏุฉ ูุงูุฅุฏุงุฑุฉ ุงููุฏุฑุณูุฉ</td><td>ุฑูุน ููุงุกุฉ ุงูุฅุฏุงุฑุฉ ุงููุฏุฑุณูุฉ ูู ุงูุชูุซูู ุงูุฑููู ูุงูุดุฑุงูุงุช.</td><td>ุฅูุดุงุก ูุธุงู ุฅููุชุฑููู ููุชุงุจุนุฉ ุงูุฃุฏุงุก ูุฑุจุท ุงูุฎุทุฉ ุงูุชุดุบูููุฉ ุจุงููุคุดุฑุงุชุ ูุชูุนูู ุซูุงุซ ุดุฑุงูุงุช ูุฌุชูุนูุฉ ููุนูุฉ.</td><td>6 ุฃุณุงุจูุน</td><td>ุงุฑุชูุงุน ุนุฏุฏ ุงูุดุฑุงูุงุช 50% ูุชุญุณู ุงููุคุดุฑุงุช ุงูุฃุณุจูุนูุฉ.</td><td>ูุฏูุฑ ุงููุฏุฑุณุฉ ููุฑูู ุงูุชููุฒ.</td></tr>
      <tr class="row-verygood"><td>ุงูุชุนููู ูุงูุชุนููู</td><td>ุชุญุณูู ุฌูุฏุฉ ุงูููุงุฑุณุงุช ุงูุตููุฉ ูุชูููุน ุฃุณุงููุจ ุงูุชุนููู.</td><td>ุชุฏุฑูุจ 80% ูู ุงููุนูููู ุนูู ุฃุฏูุงุช ุงูุชุนููู ุงูุฅููุชุฑููู ูุชุทุจูููุง ูู ุงูุฏุฑูุณ.</td><td>8 ุฃุณุงุจูุน</td><td>ุฒูุงุฏุฉ ุชุทุจูู ุงูุงุณุชุฑุงุชูุฌูุงุช ุงูุชูุงุนููุฉ ุฅูู 85%.</td><td>ูููู ุงูุดุคูู ุงูุชุนููููุฉ ููุฑูู ุงูุชุทููุฑ ุงููููู.</td></tr>
      <tr class="row-excellent"><td>ููุงุชุฌ ุงูุชุนููู</td><td>ุฑูุน ุงูุชุญุตูู ุงูุฏุฑุงุณู ูุชุนุฒูุฒ ุงูุงุชุฌุงูุงุช ุงูุฅูุฌุงุจูุฉ.</td><td>ุชูููุฐ ุจุฑุงูุฌ ุฏุนู ุฃูุงุฏููู ููููุงุฏ ุงูุญุฑุฌุฉ ูุฅุทูุงู ูุจุงุฏุฑุฉ "ูุฏุฑุณุชู ูุณุคูููุชู".</td><td>10 ุฃุณุงุจูุน</td><td>ุชุญุณู ูุชุงุฆุฌ ุงูุชุญุตูู 10%ุ ูุดุงุฑูุฉ ุทูุงุจูุฉ 30%.</td><td>ูุฑูู ุงูุชุญุตูู ุงูุฏุฑุงุณู ูุงููุดุงุท ุงูุทูุงุจู.</td></tr>
      <tr class="row-verygood"><td>ุงูุจูุฆุฉ ุงููุฏุฑุณูุฉ</td><td>ุชุทููุฑ ุงูุจูุฆุฉ ุงูุชุนููููุฉ ูุชููู ุขููุฉ ูุฌุงุฐุจุฉ ููููุฃุฉ ููุฌููุน.</td><td>ุชูููุฐ ูุดุฑูุน โุจูุฆุฉ ุชุนููููุฉ ูููุฃุฉโ ูุชุทููุฑ ุงููุตูู ูุชุญุณูู ุงูุฅุถุงุกุฉ ูุงูุชูููุฉ ูุงูููุฑุงุช.</td><td>8 ุฃุณุงุจูุน</td><td>ุชุญููู 100% ููุนุงููุฑ ุงูุณูุงูุฉ ูุงุณุชููุงุก ุงููุฑุงูู.</td><td>ูุฏูุฑ ุงููุฏุฑุณุฉ ููุฑูู ุงูุตูุงูุฉ ูุงูุฅุดุฑุงู.</td></tr>
    </tbody>
  </table>

  <h3>๐ฆ ุฑุงุจุนูุง: ุขููุฉ ุงููุชุงุจุนุฉ ูุงูุชูููู</h3>
  <ul>
    <li>ุงุฌุชูุงุนุงุช ุฃุณุจูุนูุฉ ููุฑูู ุงูุชููุฒ ูููุงุณ ุงูุชูุฏู ุญุณุจ ุงูุฌุฏูู ุงูุฒููู.</li>
    <li>ุชุญุฏูุซ ููุญุฉ ุงูุฃุฏุงุก ุงููุคุณุณู ุฅููุชุฑููููุง ูุชูุซูู ุงูุฅูุฌุงุฒ ุจุงูุตูุฑ ูุงูุชูุงุฑูุฑ.</li>
    <li>ุชุญููู ูุตู ูุตูู ููุฃุฏุงุก ุจุงุณุชุฎุฏุงู ุฃุฏูุงุช ุงูููุงุณ ุงููุนุชูุฏุฉ.</li>
    <li>ูุชุงุจุนุฉ ุงูุฃุซุฑ ุงูุชุญุณููู ุนูู ุงูุชุญุตูู ุงูุฏุฑุงุณู ูุงูุงูุถุจุงุท ุงูุณูููู.</li>
    <li>ุฅุนุฏุงุฏ ุชูุฑูุฑ ุฎุชุงูู ููุซูู ูุฑูุน ุฅูู ุฅุฏุงุฑุฉ ุงูุชุนููู.</li>
  </ul>

  <h3>๐ฆ ุฎุงูุณูุง: ูุคุดุฑุงุช ููุงุณ ุงูุชุญุณูู</h3>
  <table>
    <thead><tr><th>ุงููุฌุงู</th><th>ุงููุคุดุฑ ุงูููู</th><th>ุงููุณุชูุฏู</th><th>ุฃุฏุงุฉ ุงูููุงุณ</th><th>ุฏูุฑุฉ ุงูููุงุณ</th></tr></thead>
    <tbody>
      <tr><td>ุงูููุงุฏุฉ ูุงูุฅุฏุงุฑุฉ</td><td>ูุณุจุฉ ุชูุนูู ุงูุดุฑุงูุงุช ุงููุฌุชูุนูุฉ</td><td>50% โ</td><td>ูุงุนุฏุฉ ุจูุงูุงุช โ ุชูุงุฑูุฑ</td><td>ุดูุฑููุง</td></tr>
      <tr><td>ุงูุชุนููู ูุงูุชุนููู</td><td>ูุณุจุฉ ุชุทุจูู ุงูุชุนููู ุงูุฅููุชุฑููู ูู ุงูุฏุฑูุณ</td><td>85% โ</td><td>ุฒูุงุฑุงุช ุตููุฉ โ ุงุณุชุจุงูุงุช</td><td>ุดูุฑููุง</td></tr>
      <tr><td>ููุงุชุฌ ุงูุชุนููู</td><td>ูุชูุณุท ุงูุชุญุตูู ุงูุฏุฑุงุณู ุงูุนุงู</td><td>10% โ</td><td>ุชุญููู ูุชุงุฆุฌ โ ุงุฎุชุจุงุฑุงุช ูุนูุงุฑูุฉ</td><td>ูุตูููุง</td></tr>
      <tr><td>ุงูุจูุฆุฉ ุงููุฏุฑุณูุฉ</td><td>ูุณุจุฉ ุงุณุชููุงุก ูุนุงููุฑ ุงูุณูุงูุฉ ูุงููุฑุงูู</td><td>100% โ</td><td>ุงุณุชูุงุฑุงุช ููุฏุงููุฉ โ ุชูุงุฑูุฑ ูููุฉ</td><td>ุดูุฑููุง</td></tr>
    </tbody>
  </table>

  <h3>๐ฆ ุณุงุฏุณูุง: ุงูุชูุตูุงุช ุงูุนุงูุฉ</h3>
  <ul>
    <li>ุชุนุฒูุฒ ุซูุงูุฉ ุงูุชุญุณูู ุงููุณุชูุฑ ุฏุงุฎู ุงููุฏุฑุณุฉ.</li>
    <li>ุชุจูู ุงูุชุญูู ุงูุฑููู ูู ุฌููุน ุนูููุงุช ุงูุชูุซูู ูุงููุชุงุจุนุฉ.</li>
    <li>ุงูุงุณุชุซูุงุฑ ูู ุงูุชุทููุฑ ุงููููู ูููุนูููู ููู ุงุญุชูุงุฌุงุชูู ุงููุนููุฉ.</li>
    <li>ุฏุนู ูุดุงุฑูุฉ ุฃูููุงุก ุงูุฃููุฑ ูุงููุฌุชูุน ุงููุญูู ูุดุฑูุงุก ูู ุงูุฌูุฏุฉ.</li>
    <li>ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุฐููุฉ ุชุฑุจุท ุจูู ุงูุชุญูููุ ุงูุฃุฏุงุกุ ูุฎุทุท ุงูุชุญุณูู.</li>
  </ul>

  <h3>๐ฆ ุณุงุจุนูุง: ุงูุชูููุน</h3>
  <div>ูุฏูุฑ ุงููุฏุฑุณุฉ: ููุฏ ุญุงูุฏ ุนูู ุงูุฒูุฑุงูู</div>
  <div>ุงูุชุงุฑูุฎ: โฆ / โฆ / 1447ูู</div>
  `;
}

/* ====== ุงูุฎุทุฉ ุงูุดุงููุฉ (ููุง ุทูุจุช) ====== */
function buildComprehensivePlan(){
  return `
  <h2>๐ฉ ุฎุทุฉ ุงูุชุญุณูู ุงูุดุงููุฉ โ ุซุงูููุฉ ุงููุนููุจู ุจุงูุฎุจุฑ (ุงูุนุงู ุงูุฏุฑุงุณู 1447ูู)</h2>
  <div><strong>ุฅุนุฏุงุฏ: ูุฏูุฑ ุงููุฏุฑุณุฉ / ููุฏ ุญุงูุฏ ุนูู ุงูุฒูุฑุงูู</strong></div>
  <table>
    <thead>
      <tr><th>ุงููุฌุงู</th><th>ุงููุฏู ุงูุนุงู</th><th>ููุงุท ุงูููุฉ</th><th>ูุฑุต ุงูุชุญุณูู</th><th>ุงูุฅุฌุฑุงุก ุงูุชุญุณููู (SMART)</th><th>ุงููุฏุฉ ุงูุฒูููุฉ</th><th>ูุคุดุฑ ุงูููุงุณ</th><th>ุฌูุฉ ุงูุชูููุฐ ูุงููุชุงุจุนุฉ</th></tr>
    </thead>
    <tbody>
      <tr class="row-verygood"><td>ุงูููุงุฏุฉ ูุงูุฅุฏุงุฑุฉ ุงููุฏุฑุณูุฉ</td><td>ุฑูุน ููุงุกุฉ ุงูุฅุฏุงุฑุฉ ุงููุฏุฑุณูุฉ ูู ุงูุชูุซูู ุงูุฑููู ูุงูุดุฑุงูุงุช.</td><td>ูุฌูุฏ ุฎุทุฉ ุชุดุบูููุฉ ูุนูุงูุฉุ ุชูุนูู ุงูุฑุฎุตุฉ ุงูููููุฉ.</td><td>ุถุนู ุงูุชูุซูู ุงูุฑููู ูููุฉ ุงูุดุฑุงูุงุช ุงูููุนูุฉ.</td><td>ุฅูุดุงุก ูุธุงู ูุชุงุจุนุฉ ุฅููุชุฑููู ูุฑุจุทู ุจุงููุคุดุฑุงุช ุฃุณุจูุนููุงุ ูุชูุนูู 3 ุดุฑุงูุงุช ูุฌุชูุนูุฉ ููุนูุฉ.</td><td>6 ุฃุณุงุจูุน</td><td>ุงุฑุชูุงุน ุนุฏุฏ ุงูุดุฑุงูุงุช ุงูููุซูุฉ ุจูุณุจุฉ 50% ูุชุญุณู ูุคุดุฑุงุช ุงูุฃุฏุงุก.</td><td>ูุฏูุฑ ุงููุฏุฑุณุฉ ููุฑูู ุงูุชููุฒ.</td></tr>
      <tr class="row-verygood"><td>ุงูุชุนููู ูุงูุชุนููู</td><td>ุชุญุณูู ุฌูุฏุฉ ุงูููุงุฑุณุงุช ุงูุตููุฉ ูุชูููุน ุฃุณุงููุจ ุงูุชุนููู.</td><td>ุชุทุจูู ุงุณุชุฑุงุชูุฌูุงุช ุญุฏูุซุฉ โ ุชุบุฐูุฉ ุฑุงุฌุนุฉ ูุนุงูุฉ.</td><td>ุถุนู ุชูุธูู ุงูุชูููุฉ ูููุฉ ุงูุชููุน ูู ุทุฑู ุงูุชุนููู.</td><td>ุชุฏุฑูุจ 80% ูู ุงููุนูููู ุนูู ุฃุฏูุงุช ุงูุชุนูู ุงูุฅููุชุฑููู ูุชูุนูููุง ูู ุฎุทุท ุงูุฏุฑูุณ ุงูุฃุณุจูุนูุฉ.</td><td>8 ุฃุณุงุจูุน</td><td>ุงุฑุชูุงุน ูุณุจุฉ ุชุทุจูู ุงูุชุนููู ุงููุดุท ูุงูุชููู ุฅูู 85%.</td><td>ูููู ุงูุดุคูู ุงูุชุนููููุฉ ููุฑูู ุงูุชุทููุฑ ุงููููู.</td></tr>
      <tr class="row-excellent"><td>ููุงุชุฌ ุงูุชุนููู</td><td>ุฑูุน ุงูุชุญุตูู ุงูุฏุฑุงุณู ูุชุนุฒูุฒ ุงูุงุชุฌุงูุงุช ุงูุฅูุฌุงุจูุฉ ูุฏู ุงูุทูุงุจ.</td><td>ุงูุชุฒุงู ุณููููุ ุงุนุชุฒุงุฒ ุจุงููููุฉ ุงููุทููุฉ.</td><td>ุชูุงูุช ุงููุชุงุฆุฌ ูุถุนู ุงููุดุงุฑูุฉ ุงููุฌุชูุนูุฉ.</td><td>ุชูููุฐ ุจุฑูุงูุฌ ุฏุนู ุฃูุงุฏููู ููููุงุฏ ููุฎูุถุฉ ุงูุฃุฏุงุกุ ูุฅุทูุงู ูุจุงุฏุฑุงุช ูุฌุชูุนูุฉ โูุฏุฑุณุชู ูุณุคูููุชูโ.</td><td>10 ุฃุณุงุจูุน</td><td>ุชุญุณู ูุชุงุฆุฌ ุงูุชุญุตูู ุจูุณุจุฉ 10%ุ ูุงุฑุชูุงุน ุงููุดุงุฑูุฉ ุงูุทูุงุจูุฉ ุจูุณุจุฉ 30%.</td><td>ูุฑูู ุงูุชุญุตูู ุงูุฏุฑุงุณู ูุงููุดุงุท ุงูุทูุงุจู.</td></tr>
      <tr class="row-verygood"><td>ุงูุจูุฆุฉ ุงููุฏุฑุณูุฉ</td><td>ุชุทููุฑ ุงูุจูุฆุฉ ุงูุชุนููููุฉ ูุชููู ุขููุฉ ูุฌุงุฐุจุฉ ููููุฃุฉ ููุฌููุน.</td><td>ุจูุฆุฉ ูุธููุฉ ูุขููุฉุ ุชุทุจูู ุงุดุชุฑุงุทุงุช ุงูุณูุงูุฉ.</td><td>ุถุนู ุชุฌููุฒ ูุฑุงูู ุฐูู ุงูุฅุนุงูุฉ ูุงูุชูููุฉ ูู ุจุนุถ ุงููุตูู.</td><td>ุชูููุฐ ูุดุฑูุน โุจูุฆุฉ ุชุนููููุฉ ูููุฃุฉโ ูุตูุงูุฉ ุงููุตูู ูุชุญุณูู ุงูุฅุถุงุกุฉ ูุงูุชูููุฉ ูุงูููุฑุงุช.</td><td>8 ุฃุณุงุจูุน</td><td>ุชุญููู ุงุณุชููุงุก 100% ููุนุงููุฑ ุงูุฃูู ูุงูุณูุงูุฉ ูุฌูุฏุฉ ุงููุฑุงูู.</td><td>ูุฏูุฑ ุงููุฏุฑุณุฉ ููุฑูู ุงูุตูุงูุฉ ูุงูุฅุดุฑุงู.</td></tr>
    </tbody>
  </table>

  <h3>๐น ุขููุฉ ุงููุชุงุจุนุฉ ูุงูุชูููู</h3>
  <ul>
    <li>ุนูุฏ ุงุฌุชูุงุนุงุช ูุฑูู ุงูุชููุฒ ุฃุณุจูุนููุง ููุฑุงุฌุนุฉ ุงูุชูุฏู ูู ูู ูุฌุงู.</li>
    <li>ุชุญุฏูุซ ููุญุฉ ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงููุคุณุณู ุฅููุชุฑููููุง ุจุดูู ุฏูุฑู.</li>
    <li>ุฑูุน ุชูุงุฑูุฑ ูุตููุฉ ููุฅุฏุงุฑุฉ ุงูุนุงูุฉ ููุชุนููู.</li>
    <li>ุชูููู ุฃุซุฑ ุงูุชุญุณูู ุจุนุฏ ูู ูุชุฑุฉ ุชูููุฐ ูู ุฎูุงู ุฃุฏูุงุช ุงูููุงุณ.</li>
    <li>ุชูุซูู ุงููุชุงุฆุฌ ูุงูุดูุงูุฏ ุฅููุชุฑููููุง ุนุจุฑ ููุตุงุช ุงููุฏุฑุณุฉ.</li>
  </ul>

  <h3>๐น ูุคุดุฑุงุช ุงููุฌุงุญ ุงูุนุงูุฉ</h3>
  <ul>
    <li>ุงุฑุชูุงุน ุงูุฃุฏุงุก ุงูุนุงู ูููุฌุงูุงุช ุงูุฃุฑุจุนุฉ ุจูุณุจุฉ ูุง ุชูู ุนู 10% ุจููุงูุฉ ุงูุนุงู.</li>
    <li>ุชุญููู ุฑุถุง ุงููุณุชููุฏูู (ูุนูููู โ ุทูุงุจ โ ุฃูููุงุก ุฃููุฑ) ุจูุณุจุฉ 90%.</li>
    <li>ุงุณุชุฏุงูุฉ ููุงุฑุณุงุช ุงูุชุญุณูู ูู ุฎูุงู ูุฑู ุงูุนูู ุงููุฏุฑุณูุฉ.</li>
  </ul>
  `;
}

/* ====== ุฃุฒุฑุงุฑ ุนููุง ====== */
document.getElementById('btnFullReport').addEventListener('click',()=>openDocWindow('ุงูุชูุฑูุฑ ุงูุดุงูู',buildComprehensiveReport()));
document.getElementById('btnFullPlan').addEventListener('click',()=>openDocWindow('ุงูุฎุทุฉ ุงูุดุงููุฉ',buildComprehensivePlan()));
document.getElementById('btnAnalyze').addEventListener('click',renderDashboard);

/* ุจุฏุก ุงูุชุดุบูู */
renderDashboard();
</script>
</body>
</html>
