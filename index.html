<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ù…Ù†ØµØ© Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ â€“ Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ÙŠØ¹Ù‚ÙˆØ¨ÙŠ</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --moe:#0b7e88; --ink:#06353b; --bg:#f5f8f8; --card:#ffffff;
  --muted:#6f8e94;
  --ok:#e9fff4; --vg:#eef5ff; --gd:#fff6ec; --md:#ffefef;
  --lv-excel:#16a34a; --lv-progress:#2563eb; --lv-launch:#f59e0b; --lv-ready:#e11d48;
  --hero-h: clamp(220px, 30vh, 360px);
}
*{box-sizing:border-box}
html,body{
  margin:0;background:var(--bg);color:var(--ink);
  font-family:'Tajawal',sans-serif;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  text-rendering:optimizeLegibility; font-kerning:normal; font-synthesis:none;
}
a{color:#135;text-decoration:none}
a:hover{text-decoration:underline}

/* Ù‡ÙŠØ¯Ø± Ø¨Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© ÙˆØ¨Ø¯ÙˆÙ† Ù„Ù…Ø¹Ø§Ù† */
.hero{
  width:100vw; margin-left:calc(50% - 50vw);
  background:var(--bg);
  border-radius:0 0 24px 24px;
  box-shadow:0 10px 28px rgba(0,0,0,.08);
  position:relative; overflow:hidden;
  padding:0; margin:0 0 14px;
  height:var(--hero-h);
  display:flex; align-items:center; justify-content:center;
}
.hero .brand{
  width:min(1200px,92vw);
  height:calc(var(--hero-h) - 24px);
  background:url('logo.png') center/contain no-repeat;
}

.page{max-width:1200px;margin:0 auto;padding:0 14px}

/* Ø£Ø²Ø±Ø§Ø± Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© */
.controls{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;padding:6px 0 10px}
.btn{background:var(--moe);color:#fff;border:0;border-radius:12px;padding:10px 16px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(11,126,136,.25)}
.btn.light{background:#eef6f7;color:#06353b}
.btn.ghost{background:#fff;color:var(--moe);border:1px solid #d7ecec}
.btn:hover{filter:brightness(.97)}
.btn.eval{background:linear-gradient(135deg,#0b7e88,#22b8a0);box-shadow:0 8px 20px rgba(11,126,136,.25)}

/* Ø§Ù„Ø´Ø¨ÙƒØ© */
.grid{display:grid;grid-template-columns:repeat(4,minmax(220px,1fr));gap:16px}
@media (max-width:1150px){.grid{grid-template-columns:repeat(3,minmax(220px,1fr))}}
@media (max-width:900px){.grid{grid-template-columns:repeat(2,minmax(220px,1fr))}}
@media (max-width:520px){.grid{grid-template-columns:1fr}}

/* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
.card{
  background:linear-gradient(180deg,#ffffff 0%,#f9feff 100%);
  border-radius:16px;padding:14px;position:relative;
  box-shadow:0 10px 24px rgba(0,0,0,.08),inset 0 0 0 1px #e6efef;
}
.card h2{margin:0 0 6px;color:var(--moe);font-size:20px}
.kpi{display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px;gap:8px;flex-wrap:wrap}
.progress{height:10px;background:#e6efef;border-radius:999px;overflow:hidden;margin:8px 0}
.bar{height:100%;background:#2aa897}

/* Ø§Ù„Ø´Ø§Ø±Ø© ÙƒÙ†Øµ ÙˆØ§Ø¶Ø­ (ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰) */
.badge{background:none;border:none;padding:0;font-size:19px;font-weight:700;line-height:1;white-space:nowrap;letter-spacing:0;-webkit-text-stroke:0;text-shadow:none}
.badge.excel{color:var(--lv-excel)}
.badge.progress{color:var(--lv-progress)}
.badge.launch{color:var(--lv-launch)}
.badge.ready{color:var(--lv-ready)}

/* Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø¨Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© + Ø§Ù„Ø´Ø§Ø±Ø© Ø¯Ø§Ø®Ù„Ù‡Ø§ */
.donutWrap{position:relative; height:180px; display:flex; align-items:center; justify-content:center}
.donutCanvas{position:relative; width:100%; height:100%}
.donutCenter{
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  display:flex; flex-direction:column; align-items:center; gap:4px; text-align:center; pointer-events:none;
}
.donutCenter .lvl{font-size:18px;font-weight:800;line-height:1}
.donutCenter .pct{font-size:12px;color:#6f8e94}

/* Ø£Ø²Ø±Ø§Ø± Ø£Ø³ÙÙ„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© (Ù…ØµØºÙ‘Ø±Ø© ÙˆØ£Ù†ÙŠÙ‚Ø©) */
.centerBar{display:flex;gap:8px;justify-content:center;align-items:center;margin:8px 0;flex-wrap:wrap}
.btn.micro{
  padding:6px 10px; border-radius:999px; font-size:12px; font-weight:700;
  border:1px dashed #cfe4e6; background:#fff; color:var(--moe);
  box-shadow:0 4px 10px rgba(11,126,136,.12);
}
.btn.micro:hover{background:#f4fbfb}

/* Ù„ÙˆØ­Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ */
.fullpanel{position:fixed;inset:0;z-index:9998;background:rgba(6,53,59,.06);display:none;align-items:flex-start;justify-content:center;padding:12px 8px 24px}
.fullpanel .inner{width:min(1200px,96vw);max-height:90vh;overflow:auto;background:#fff;border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,.20);padding:14px}
.fullpanel .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px;flex-wrap:wrap}
.fullpanel .topbar .title{font-weight:700;color:#0b7e88}
.fullpanel .close{background:#e8eff0;color:#034;border:0;border-radius:10px;padding:8px 12px;cursor:pointer;font-weight:700}
.subgrid{display:grid;grid-template-columns:repeat(2,minmax(160px,1fr));gap:8px}
@media (max-width:680px){.subgrid{grid-template-columns:1fr}}
.subCard{background:#f7fbfb;border:1px solid #e6efef;border-radius:12px;padding:10px}

/* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
.tableWrap{margin-top:10px;overflow:auto}
table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden;table-layout:fixed}
thead th{background:#0f6f79;color:#fff;padding:10px;font-weight:700}
tbody td{padding:10px;border-bottom:1px solid #eef3f3;vertical-align:top;word-break:break-word}
tbody tr:last-child td{border-bottom:0}
.row-excellent{background:var(--ok)}
.row-verygood{background:var(--vg)}
.row-good{background:var(--gd)}
.row-medium{background:var(--md)}
.level{font-weight:700}

/* Ø´Ø§Ø±Ø© Ø§Ù„Ø´Ø§Ù‡Ø¯ ÙƒØ±Ø§Ø¨Ø· ØµØºÙŠØ± */
.evi-chip{display:inline-block; font-size:12px; font-weight:700; padding:4px 8px; border-radius:999px; margin:.2rem .2rem 0 0; background:rgba(6,53,59,.06); color:#06353b}
.evi-chip:hover{background:rgba(6,53,59,.12)}

/* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯ */
.modal{position:fixed;inset:0;background:rgba(2,52,59,.6);backdrop-filter:blur(2px);display:none;align-items:center;justify-content:center;z-index:9999}
.sheet{width:min(940px,96vw);max-height:92vh;overflow:auto;background:#fff;border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.35);padding:16px}
.sheet h4{margin:0 0 8px}
.row{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
@media (max-width:760px){.row{grid-template-columns:1fr 1fr}}
@media (max-width:480px){.row{grid-template-columns:1fr}}
.row label{font-size:12px;color:#345}
input[type=text],input[type=file],select{border:1px solid #d7e7e7;border-radius:8px;padding:8px;width:100%}
.sheet .close{position:sticky;top:0;margin-bottom:8px;background:#e8eff0;border:0;color:#034;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:700}
.btn-evi{background:#0b7e88;color:#fff;border:0;border-radius:999px;padding:8px 14px;cursor:pointer;box-shadow:0 6px 16px rgba(11,126,136,.25);display:inline-flex;align-items:center;gap:6px}
.btn-evi svg{width:16px;height:16px}

/* Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
@page{size:A4;margin:10mm}
@media print{
  .controls,.no-print,.fullpanel,.modal{display:none!important}
  .page{max-width:100%;margin:0 auto!important;padding:0 10mm}
  .hero{box-shadow:none!important;border-radius:0!important}
}

/* Ø¹Ù†Ø§ØµØ± ØªØ²ÙŠÙŠÙ† Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ± */
.nowrap-title{white-space:nowrap;overflow:hidden;text-overflow:clip;text-align:center}
.small-list{font-size:13px;line-height:1.45}
.small-list li{margin:.2rem 0}
.footer{padding:18px 10px;text-align:center;color:#7a9aa0}
</style>
</head>
<body>

<!-- Ù‡ÙŠØ¯Ø± -->
<div class="hero" aria-label="ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… â€“ Ø´Ø¹Ø§Ø±">
  <div class="brand"></div>
</div>

<div class="page">
  <div class="controls">
    <button class="btn eval" id="btnExt2025">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù¢Ù Ù¢Ù¥Ù… ğŸ“„</button>
    <button class="btn eval" id="btnExt2024">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù¢Ù Ù¢Ù¤Ù… ğŸ“„</button>
    <button class="btn" id="btnAnalyze">ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ ğŸ”</button>
    <button class="btn" id="btnFullReport">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ ğŸ“˜</button>
    <button class="btn" id="btnFullPlan">Ø®Ø·Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ† ğŸ—‚ï¸</button>
  </div>

  <div id="dashboard" class="grid"></div>

  <div class="footer">ØªÙ†ÙÙŠØ° ÙˆØªØµÙ…ÙŠÙ… ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</div>
</div>

<!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¬Ø§Ù„ -->
<div class="fullpanel" id="fullPanel" aria-hidden="true">
  <div class="inner">
    <div class="topbar">
      <div class="title" id="fpTitle">Ø§Ù„ØªÙØ§ØµÙŠÙ„</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn light" id="fpHome">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© âŸµ</button>
        <button class="close" id="fpClose">Ø¥ØºÙ„Ø§Ù‚ âœ•</button>
      </div>
    </div>
    <div id="fpBody"></div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯ -->
<div class="modal" id="eviModal" aria-hidden="true">
  <div class="sheet">
    <button class="close" id="eviClose">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
    <h4 style="text-align:center">Ø¥Ø¶Ø§ÙØ© Ø´Ø§Ù‡Ø¯</h4>
    <div class="row" style="margin-bottom:8px">
      <div><label>Ø§Ø³Ù…/ÙˆØµÙ Ø§Ù„Ø´Ø§Ù‡Ø¯</label><input id="eviText" type="text" placeholder="Ù…Ø«Ø§Ù„: ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ ØµÙ1.."/></div>
      <div><label>Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
        <select id="eviTerm"><option value="T1">Ø§Ù„Ø£ÙˆÙ„</option><option value="T2">Ø§Ù„Ø«Ø§Ù†ÙŠ</option></select>
      </div>
      <div><label>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ (Ù‡Ø¬Ø±ÙŠ)</label><select id="eviWeek"></select></div>
      <div><label>Ø§Ù„ØªØ§Ø±ÙŠØ® (Ù‡Ø¬Ø±ÙŠ Ø£Ù… Ø§Ù„Ù‚Ø±Ù‰)</label><input id="eviHijri" type="text" placeholder="1447/03/01"/></div>
    </div>
    <div class="row">
      <div><label>Ø±ÙØ¹ Ù…Ù„Ù (PDF/ØµÙˆØ±Ø©)</label><input id="eviFile" type="file" accept="application/pdf,image/*"/></div>
      <div style="grid-column:span 3"><label>ÙŠØªØ¨Ø¹</label><input id="eviOwner" type="text" disabled/></div>
    </div>
    <div style="display:flex;gap:8px;margin-top:8px;justify-content:center">
      <button class="btn" id="eviSave">Ø­ÙØ¸ Ø§Ù„Ø´Ø§Ù‡Ø¯</button>
      <button class="btn light" id="eviCancel">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
    <div class="small" style="margin-top:6px;text-align:center">* Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯ ØªÙØ­ÙØ¸ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ© ÙˆØªÙØ³Ø­Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ®Ø·Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ†.</div>
  </div>
</div>

<script>
/* Ù…ØµØ§Ø¯Ø± ÙˆØ¥Ø®ÙØ§Ø¡Ù‡Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± */
const SRC_2025='https://drive.google.com/file/d/1s0Rrv8gYkAbbZU3YudxWVC943iU18Df0/view?usp=drive_link';
const SRC_2024='https://drive.google.com/file/d/1YsfKzyjQl1SHuz24LLepZk8lb_ylf1Ar/view?usp=drive_link';
const LAST_SYNC=new Date().toLocaleString('ar-SA');

/* Ø£Ø³Ø§Ø¨ÙŠØ¹ Ù‡Ø¬Ø±ÙŠ */
const TERM1=[{w:1,from:'01 / 03 / 1447',to:'05 / 03 / 1447',note:'Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ'},{w:2,from:'08 / 03 / 1447',to:'12 / 03 / 1447'},{w:3,from:'15 / 03 / 1447',to:'19 / 03 / 1447'},{w:4,from:'22 / 03 / 1447',to:'26 / 03 / 1447'},{w:5,from:'29 / 03 / 1447',to:'03 / 04 / 1447'},{w:6,from:'06 / 04 / 1447',to:'10 / 04 / 1447'},{w:7,from:'13 / 04 / 1447',to:'17 / 04 / 1447'},{w:8,from:'20 / 04 / 1447',to:'24 / 04 / 1447'},{w:9,from:'27 / 04 / 1447',to:'01 / 05 / 1447'},{w:10,from:'04 / 05 / 1447',to:'08 / 05 / 1447'},{w:11,from:'11 / 05 / 1447',to:'15 / 05 / 1447'},{w:12,from:'18 / 05 / 1447',to:'22 / 05 / 1447'},{w:13,from:'25 / 05 / 1447',to:'29 / 05 / 1447'},{w:'â€”',from:'30 / 05 / 1447',to:'08 / 06 / 1447',note:'ğŸ‚ Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø®Ø±ÙŠÙ'},{w:14,from:'09 / 06 / 1447',to:'13 / 06 / 1447',note:'Ø¨Ø¹Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©'},{w:15,from:'16 / 06 / 1447',to:'20 / 06 / 1447'},{w:16,from:'23 / 06 / 1447',to:'27 / 06 / 1447'},{w:17,from:'30 / 06 / 1447',to:'04 / 07 / 1447'},{w:18,from:'07 / 07 / 1447',to:'11 / 07 / 1447'},{w:19,from:'14 / 07 / 1447',to:'18 / 07 / 1447',note:'âœ³ï¸ Ø®ØªØ§Ù… Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„'}];
const TERM2=[{w:1,from:'29 / 07 / 1447',to:'03 / 08 / 1447',note:'Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ'},{w:2,from:'06 / 08 / 1447',to:'10 / 08 / 1447'},{w:3,from:'13 / 08 / 1447',to:'17 / 08 / 1447'},{w:4,from:'20 / 08 / 1447',to:'24 / 08 / 1447'},{w:5,from:'27 / 08 / 1447',to:'02 / 09 / 1447'},{w:6,from:'05 / 09 / 1447',to:'09 / 09 / 1447'},{w:7,from:'12 / 09 / 1447',to:'15 / 09 / 1447',note:'Ø¢Ø®Ø± Ø£Ø³Ø¨ÙˆØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©'},{w:'â€”',from:'16 / 09 / 1447',to:'10 / 10 / 1447',note:'ğŸ•Œ Ø¥Ø¬Ø§Ø²Ø© Ø±Ù…Ø¶Ø§Ù† ÙˆØ¹ÙŠØ¯ Ø§Ù„ÙØ·Ø±'},{w:8,from:'10 / 10 / 1447',to:'14 / 10 / 1447',note:'Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¹ÙŠØ¯'},{w:9,from:'17 / 10 / 1447',to:'21 / 10 / 1447'},{w:10,from:'24 / 10 / 1447',to:'28 / 10 / 1447'},{w:11,from:'01 / 11 / 1447',to:'05 / 11 / 1447'},{w:12,from:'08 / 11 / 1447',to:'12 / 11 / 1447'},{w:13,from:'15 / 11 / 1447',to:'19 / 11 / 1447'},{w:14,from:'22 / 11 / 1447',to:'26 / 11 / 1447'},{w:15,from:'29 / 11 / 1447',to:'03 / 12 / 1447'},{w:'â€”',from:'04 / 12 / 1447',to:'14 / 12 / 1447',note:'ğŸ•‹ Ø¥Ø¬Ø§Ø²Ø© Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰'},{w:16,from:'15 / 12 / 1447',to:'19 / 12 / 1447',note:'Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ø¶Ø­Ù‰'},{w:17,from:'22 / 12 / 1447',to:'26 / 12 / 1447'},{w:18,from:'29 / 12 / 1447',to:'03 / 01 / 1448'},{w:19,from:'06 / 01 / 1448',to:'10 / 01 / 1448',note:'Ø®ØªØ§Ù… Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„ÙØµÙ„'}];

/* Ø£Ø¯ÙˆØ§Øª Ø¹Ø§Ù…Ø© */
const fmt=v=>Number(v).toFixed(2);
function todayHijri(){try{const f=new Intl.DateTimeFormat('ar-SA-u-ca-islamic',{year:'numeric',month:'2-digit',day:'2-digit',weekday:'long'});return f.format(new Date());}catch(e){return '.../.. /1447Ù‡Ù€'}}
function perfLevel(pct){
  if(pct>=90) return {name:'Ø§Ù„ØªÙ…ÙŠÙ‘Ø²', key:'excel',  color:getComputedStyle(document.documentElement).getPropertyValue('--lv-excel').trim()};
  if(pct>=75) return {name:'Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…', key:'progress',color:getComputedStyle(document.documentElement).getPropertyValue('--lv-progress').trim()};
  if(pct>=50) return {name:'Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚', key:'launch', color:getComputedStyle(document.documentElement).getPropertyValue('--lv-launch').trim()};
  return {name:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©', key:'ready', color:getComputedStyle(document.documentElement).getPropertyValue('--lv-ready').trim()};
}
function levelRowClass(arLevel){
  if(arLevel==='Ø§Ù„ØªÙ…ÙŠÙ‘Ø²'||arLevel==='Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…') return 'row-excellent';
  if(arLevel==='Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚') return 'row-verygood';
  if(arLevel==='Ø§Ù„ØªÙ‡ÙŠØ¦Ø©') return 'row-good';
  return 'row-medium';
}

/* Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
const fields={
  management:{name:'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©',v2024:75.50,v2025:75.50,subs:[
    {id:'plans',name:'Ø§Ù„ØªØ®Ø·ÙŠØ·',v:54.00},
    {id:'lead',name:'Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©',v:72.75},
    {id:'soc',name:'Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ',v:57.25},
    {id:'dev',name:'Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ',v:60.25}
  ]},
  teaching:{name:'Ø§Ù„ØªØ¹Ù„ÙŠÙ… ÙˆØ§Ù„ØªØ¹Ù„Ù‘Ù…',v2024:80.75,v2025:81.50,subs:[
    {id:'assess',name:'ØªÙ‚ÙˆÙŠÙ… Ø§Ù„ØªØ¹Ù„Ù‘Ù…',v:82.75},
    {id:'exp',name:'Ø¨Ù†Ø§Ø¡ Ø®Ø¨Ø±Ø§Øª Ø§Ù„ØªØ¹Ù„Ù‘Ù…',v:76.75}
  ]},
  learning:{name:'Ù†ÙˆØ§ØªØ¬ Ø§Ù„ØªØ¹Ù„Ù‘Ù…',v2024:78.50,v2025:78.50,subs:[
    {id:'ach',name:'Ø§Ù„ØªØ­ØµÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ',v:80.25},
    {id:'socdev',name:'Ø§Ù„ØªØ·ÙˆØ± Ø§Ù„Ø´Ø®ØµÙŠ ÙˆØ§Ù„ØµØ­ÙŠ ÙˆØ§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ',v:86.25}
  ]},
  environment:{name:'Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©',v2024:64.00,v2025:62.25,subs:[
    {id:'safety',name:'Ø§Ù„Ø£Ù…Ù† ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø©',v:79.00},
    {id:'building',name:'Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ',v:71.50}
  ]}
};

/* Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (ÙƒØ§Ù…Ù„Ø©) */
const detailed={
  management:[
    {level:'Ø§Ù„ØªÙ…ÙŠÙ‘Ø²',perf:94.50,indicator:'ØªÙ†Ø´Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø³Ù„ÙˆÙƒ ÙˆØ§Ù„Ù…ÙˆØ§Ø¸Ø¨Ø© ÙˆØªØªØ§Ø¨Ø¹ ØªØ·Ø¨ÙŠÙ‚Ù‡Ø§ Ø¨Ø§Ù†ØªØ¸Ø§Ù….',improve:'Ù†Ø´Ø± Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø±Ù‚Ù…ÙŠÙ‹Ø§ ÙˆØ±Ø¨Ø·Ù‡Ø§ Ø¨Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ù„Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·.',evidence:'Ù„ÙˆØ­Ø§Øª Ø§Ù„Ø³Ù„ÙˆÙƒØŒ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·ØŒ Ø³Ø¬Ù„Ø§Øª Ø¥Ø´Ø¹Ø§Ø±Ø§Øª.'},
    {level:'Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…',perf:90.25,indicator:'ØªÙ‡ÙŠØ¦Ø© ÙˆØµÙŠØ§Ù†Ø© Ù…Ø±Ø§ÙÙ‚ Ø§Ù„Ù…Ø¨Ù†Ù‰ ÙˆØªØ¬Ù‡ÙŠØ²Ø§ØªÙ‡.',improve:'Ù†Ø¸Ø§Ù… ØµÙŠØ§Ù†Ø© Ø±Ù‚Ù…ÙŠ ÙˆØªÙˆØ«ÙŠÙ‚ Ø¨Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±.',evidence:'Ø£ÙˆØ§Ù…Ø± Ø¹Ù…Ù„ØŒ ØµÙˆØ± Ù‚Ø¨Ù„/Ø¨Ø¹Ø¯ØŒ Ù…Ø­Ø§Ø¶Ø± Ø¥Ù†Ø¬Ø§Ø².'},
    {level:'Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…',perf:89.25,indicator:'Ù…Ù†Ø§Ø® Ø¢Ù…Ù† ÙˆÙ…Ø­ÙÙ‘Ø² Ù„Ù„ØªØ¹Ù„Ù‘Ù… ÙˆØ§Ù„Ù†Ù…Ùˆ.',improve:'Ø¨Ø±Ø§Ù…Ø¬ Ø¯Ø¹Ù… Ù†ÙØ³ÙŠ ÙˆÙ‚ÙŠØ§Ø³ Ø±Ø¶Ø§ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† Ø¯ÙˆØ±ÙŠÙ‹Ø§.',evidence:'Ø§Ø³ØªØ¨Ø§Ù†Ø§Øª Ø±Ø¶Ø§ØŒ Ø³Ø¬Ù„Ø§Øª Ø¥Ø±Ø´Ø§Ø¯ØŒ Ø®Ø·Ø· ÙˆÙ‚Ø§Ø¦ÙŠØ©.'},
    {level:'Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚',perf:87.00,indicator:'Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† ÙˆØ¯Ø¹Ù… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ù†ÙŠ.',improve:'Ø®Ø·Ø· ØªØ·ÙˆÙŠØ± ÙØ±Ø¯ÙŠØ© Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ ØªÙ‚ÙˆÙŠÙ… Ø³Ù†ÙˆÙŠ.',evidence:'Ù†Ù…Ø§Ø°Ø¬ ØªÙ‚ÙˆÙŠÙ…ØŒ Ø®Ø·Ø· ØªØ­Ø³ÙŠÙ†ØŒ Ù…Ø­Ø§Ø¶Ø± ØªØºØ°ÙŠØ© Ø±Ø§Ø¬Ø¹Ø©.'},
    {level:'Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚',perf:85.25,indicator:'Ù…ØªØ§Ø¨Ø¹Ø© ØªÙ†ÙÙŠØ° Ø§Ù„Ø®Ø·Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© ÙˆØªØ·ÙˆÙŠØ±Ù‡Ø§.',improve:'Ù„ÙˆØ­Ø© Ù…Ø¤Ø´Ø±Ø§Øª Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© ÙˆØ±Ø¨Ø· Ø§Ù„Ù…Ù‡Ø§Ù… Ø¨Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª.',evidence:'Ù„ÙˆØ­Ø© Ø£Ø¯Ø§Ø¡ØŒ ØªÙ‚Ø§Ø±ÙŠØ± ØªÙ‚Ø¯Ù…ØŒ Ù…Ø­Ø§Ø¶Ø± ÙØ±Ù‚ Ø§Ù„Ø¹Ù…Ù„.'},
    {level:'Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚',perf:83.75,indicator:'ØªÙˆØ§ØµÙ„ ÙØ¹Ù‘Ø§Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ± ÙˆØ§Ù„Ù…Ø¬ØªÙ…Ø¹.',improve:'Ù‚Ù†ÙˆØ§Øª ØªÙˆØ§ØµÙ„ Ù…ÙˆØ­Ù‘Ø¯Ø© ÙˆØ¬Ø¯ÙˆÙ„Ø© Ù„Ù‚Ø§Ø¡Ø§Øª Ø¯ÙˆØ±ÙŠØ©.',evidence:'Ù…Ù†ØµØ© ØªÙˆØ§ØµÙ„ØŒ Ù…Ø­Ø§Ø¶Ø± Ù„Ù‚Ø§Ø¡Ø§ØªØŒ ØªÙ‚Ø§Ø±ÙŠØ± ØªÙØ§Ø¹Ù„.'},
    {level:'Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚',perf:82.00,indicator:'ØªØ´Ø¬ÙŠØ¹ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø®ØµØ© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©.',improve:'Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ­ÙÙŠØ²ÙŠ ÙˆØ¬Ø¯ÙˆÙ„Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª.',evidence:'Ù‚ÙˆØ§Ø¦Ù… ØªØ³Ø¬ÙŠÙ„ØŒ Ø´Ù‡Ø§Ø¯Ø§Øª Ø­Ø¶ÙˆØ±ØŒ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø±Ø®ØµØ©.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:80.00,indicator:'ØªØ¹Ø²ÙŠØ² Ø«Ù‚Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ.',improve:'ÙØ±Ù‚ ØªÙ…ÙŠÙ‘Ø² Ø¨Ù…Ù‡Ù…Ø§Øª ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø¥Ù†Ø¬Ø§Ø².',evidence:'ØªØ´ÙƒÙŠÙ„ Ø§Ù„ÙØ±Ù‚ØŒ Ø®Ø·Ø· ÙØ±Ù‚ØŒ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø®ØªØµØ±Ø©.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:78.00,indicator:'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù‚ÙŠÙ… ÙˆØ§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©.',improve:'Ù…Ù„Ù Ø±Ù‚Ù…ÙŠ Ù„Ù„Ù‡ÙˆÙŠØ© Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ø£Ù†Ø´Ø·Ø©.',evidence:'ØµÙˆØ± ÙØ¹Ø§Ù„ÙŠØ§ØªØŒ Ù…Ù„ÙØ§Øª Ø¥Ù†Ø¬Ø§Ø²ØŒ Ù†Ù…Ø§Ø°Ø¬ ØªÙˆØ«ÙŠÙ‚.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:76.50,indicator:'ØªÙØ¹ÙŠÙ„ Ù‚Ù†ÙˆØ§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ.',improve:'ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª ÙˆØ§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠÙ‹Ø§.',evidence:'Ø³Ø¬Ù„Ø§Øª ØªØ¹Ù…ÙŠÙ…Ø§ØªØŒ Ù…Ø­Ø§Ø¶Ø±ØŒ Ù„ÙˆØ§Ø¦Ø­ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:75.50,indicator:'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø´Ø±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ÙŠØ©.',improve:'Ø«Ù„Ø§Ø« Ø´Ø±Ø§ÙƒØ§Øª Ù†ÙˆØ¹ÙŠØ© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„ØªØ¹Ù„Ù‘Ù….',evidence:'Ù…Ø°ÙƒØ±Ø§Øª ØªÙØ§Ù‡Ù…ØŒ ØªÙ‚Ø§Ø±ÙŠØ± ÙØ¹Ø§Ù„ÙŠØ§ØªØŒ Ø´Ù‡Ø§Ø¯Ø§Øª Ø´Ø±Ø§ÙƒØ©.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:72.00,indicator:'ØªØ·ÙˆÙŠØ± Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©.',improve:'Ù„ÙˆØ­Ø© Ù…Ø¤Ø´Ø±Ø§Øª Ø°ÙƒÙŠØ© ÙˆØªØ­Ù„ÙŠÙ„Ø§Øª Ø´Ù‡Ø±ÙŠØ©.',evidence:'ØªÙ‚Ø§Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ÙŠØ©ØŒ Ù„ÙˆØ­Ø§Øª Ù‚ÙŠØ§Ø³ØŒ Ø£Ø±Ø´ÙŠÙ Ø±Ù‚Ù…ÙŠ.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:70.25,indicator:'ØªÙˆØ¸ÙŠÙ Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙÙŠ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©.',improve:'Ø±ÙØ¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… (Ù†ÙˆØ±/ÙØ§Ø±Ø³/Ù…Ø¯Ø±Ø³ØªÙŠ) ÙˆØªØªØ¨Ø¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±.',evidence:'Ø³Ø¬Ù„Ø§Øª Ø¯Ø®ÙˆÙ„ØŒ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ø³ØªØ®Ø¯Ø§Ù…ØŒ Ù…ØµÙÙˆÙØ© Ø§Ù„ØªØ²Ø§Ù….'}
  ],
  teaching:[
    {level:'Ø§Ù„ØªÙ…ÙŠÙ‘Ø²',perf:99.25,indicator:'Ø¨Ø±Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ù†ÙˆØ¹ÙŠØ© ØªØ·ÙˆÙ‘Ø± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØµÙÙ‘ÙŠØ©.',improve:'Ù…ÙˆØ§Ø¡Ù…Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØªØªØ¨Ø¹ Ø§Ù„Ø£Ø«Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­ØµØ©.',evidence:'Ø®Ø·Ø· ØªØ¯Ø±ÙŠØ¨ØŒ ØªÙ‚Ø§Ø±ÙŠØ± Ø£Ø«Ø±.'},
    {level:'Ø§Ù„ØªÙ…ÙŠÙ‘Ø²',perf:97.75,indicator:'Ø¨ÙŠØ¦Ø© Ù…Ø­ÙÙ‘Ø²Ø© Ù„Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ/Ø§Ù„Ù†Ø§Ù‚Ø¯.',improve:'ØªØ¶Ù…ÙŠÙ† Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø¹Ù„ÙŠØ§.',evidence:'Ø®Ø·Ø· Ø¯Ø±ÙˆØ³ØŒ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØµÙÙŠØ©.'},
    {level:'Ø§Ù„ØªÙ…ÙŠÙ‘Ø²',perf:97.50,indicator:'ØªÙ†Ù…ÙŠØ© Ø§Ù„ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ø°Ø§ØªÙŠ ÙˆØ§Ù„Ø¨Ø­Ø«.',improve:'Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨Ø­Ø« Ø±Ù‚Ù…ÙŠØ©.',evidence:'Ø¨Ø­ÙˆØ« Ø·Ù„Ø§Ø¨ÙŠØ©.'},
    {level:'Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…',perf:96.75,indicator:'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª ØªØ¯Ø±ÙŠØ³ Ø­Ø¯ÙŠØ«Ø©.',improve:'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ²ÙŠØ§Ø±Ø§Øª ØµÙÙŠØ©.',evidence:'ØªÙ‚Ø§Ø±ÙŠØ± Ø²ÙŠØ§Ø±Ø§Øª.'},
    {level:'Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…',perf:94.75,indicator:'ÙˆØ³Ø§Ø¦Ù„ ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø±Ù‚Ù…ÙŠØ© Ù…ØªÙ†ÙˆØ¹Ø©.',improve:'Ø¥Ù†ØªØ§Ø¬ Ù…Ø­ØªÙˆÙ‰ ØªÙØ§Ø¹Ù„ÙŠ.',evidence:'Ù…Ù„ÙØ§Øª Ø¯Ø±ÙˆØ³ Ø±Ù‚Ù…ÙŠØ©.'},
    {level:'Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…',perf:93.25,indicator:'ØªÙ†ÙˆØ¹ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙ‚ÙˆÙŠÙ….',improve:'ØªØ­Ù„ÙŠÙ„ Ø£Ø³Ø¨ÙˆØ¹ÙŠ ÙˆØ±Ø¨Ø· Ø¨Ø¹Ù„Ø§Ø¬/Ø¥Ø«Ø±Ø§Ø¡.',evidence:'Ø³Ø¬Ù„Ø§Øª ØªØ­Ù„ÙŠÙ„.'},
    {level:'Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚',perf:91.75,indicator:'ØªØºØ°ÙŠØ© Ø±Ø§Ø¬Ø¹Ø© Ø¨Ù†Ù‘Ø§Ø¡Ø©.',improve:'Ù†Ù…ÙˆØ°Ø¬ Ù…ÙˆØ­Ù‘Ø¯ ÙˆØ£Ù†Ø´Ø·Ø© ØªØµØ­ÙŠØ­ÙŠØ©.',evidence:'Ù†Ù…Ø§Ø°Ø¬ Ù…ØªØ§Ø¨Ø¹Ø©.'},
    {level:'Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚',perf:89.50,indicator:'ØªÙˆØ¸ÙŠÙ Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙÙŠ Ø§Ù„ØªØ¹Ù„Ù‘Ù….',improve:'Ø£Ø¯ÙˆØ§Øª ØªÙØ§Ø¹Ù„ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­ØµØ©.',evidence:'ØªÙ‚Ø§Ø±ÙŠØ± Â«Ù…Ø¯Ø±Ø³ØªÙŠÂ».'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:88.00,indicator:'ØªØ¹Ù„Ù‘Ù… ØªØ¹Ø§ÙˆÙ†ÙŠ ÙˆÙ…Ø´Ø§Ø±ÙŠØ¹.',improve:'Rubrics ÙˆØªÙ‚ÙˆÙŠÙ… Ø£Ø¯ÙˆØ§Ø±.',evidence:'Ù…Ù„ÙØ§Øª Ù…Ø´Ø§Ø±ÙŠØ¹.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:86.75,indicator:'ØªÙ†Ù…ÙŠØ© Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù†Ø§Ù‚Ø¯.',improve:'Ø£Ù†Ø´Ø·Ø© ØªØ­Ù„ÙŠÙ„ ÙˆÙ†Ù‚Ø§Ø´.',evidence:'Ø®Ø·Ø· Ø£Ù†Ø´Ø·Ø©.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:84.50,indicator:'Ø¨Ø±Ø§Ù…Ø¬ Ø¥Ø«Ø±Ø§Ø¦ÙŠØ© Ù„Ù„Ù…ÙˆÙ‡ÙˆØ¨ÙŠÙ†.',improve:'ÙˆØ±Ø´ Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©.',evidence:'Ù‚ÙˆØ§Ø¦Ù… Ù…Ø´Ø§Ø±ÙƒÙŠÙ†.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:82.75,indicator:'Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø¨Ù†ÙˆØ§ØªØ¬ ÙˆØ§Ø¶Ø­Ø©.',improve:'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø®Ø·Ø· Ø§Ù„ÙŠÙˆÙ…ÙŠØ©.',evidence:'Ø®Ø·Ø· Ù…Ø­Ø¯Ø«Ø©.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:76.75,indicator:'ØªÙ†ÙˆÙŠØ¹ Ø§Ù„Ø£Ø³Ø§Ù„ÙŠØ¨ Ù„Ù„ÙØ±ÙˆÙ‚ Ø§Ù„ÙØ±Ø¯ÙŠØ©.',improve:'Ø£Ù†Ø´Ø·Ø© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø£Ù†Ù…Ø§Ø·.',evidence:'ØªÙ‚Ø§Ø±ÙŠØ± ØµÙÙŠØ©.'}
  ],
  learning:[
    {level:'Ø§Ù„ØªÙ…ÙŠÙ‘Ø²',perf:96.75,indicator:'Ø§Ø¹ØªØ²Ø§Ø² Ø¨Ø§Ù„Ù‚ÙŠÙ… ÙˆØ§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©.',improve:'Ø±Ø¨Ø· Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø¨Ø§Ù„Ù‚ÙŠÙ….',evidence:'Ù…Ù†ØªØ¬Ø§Øª ÙˆØµÙˆØ± ÙØ¹Ø§Ù„ÙŠØ§Øª.'},
    {level:'Ø§Ù„ØªÙ…ÙŠÙ‘Ø²',perf:96.25,indicator:'Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© ÙˆØ¯Ø§ÙØ¹ÙŠØ©.',improve:'Ø¨Ø±Ø§Ù…Ø¬ ØªØ­ÙÙŠØ²ÙŠØ© ÙˆØ¥Ø±Ø´Ø§Ø¯.',evidence:'Ø§Ø³ØªØ¨Ø§Ù†Ø§Øª ÙˆØ®Ø·Ø·.'},
    {level:'Ø§Ù„ØªÙ…ÙŠÙ‘Ø²',perf:95.50,indicator:'Ù†ØªØ§Ø¦Ø¬ ÙˆØ·Ù†ÙŠØ©/Ø¯ÙˆÙ„ÙŠØ© Ù…ØªÙ…ÙŠØ²Ø©.',improve:'Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø¹ÙŠØ§Ø±ÙŠØ© ÙˆØ®Ø·Ø· Ø¹Ù„Ø§Ø¬.',evidence:'ØªØ­Ù„ÙŠÙ„Ø§Øª Ù†ØªØ§Ø¦Ø¬.'},
    {level:'Ø§Ù„ØªÙ…ÙŠÙ‘Ø²',perf:94.00,indicator:'Ø§Ù„ØªØ²Ø§Ù… ÙˆØ§Ù†Ø¶Ø¨Ø§Ø·.',improve:'Ù…ØªØ§Ø¨Ø¹Ø© ÙŠÙˆÙ…ÙŠØ© ÙˆØªÙƒØ±ÙŠÙ….',evidence:'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·.'},
    {level:'Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚',perf:91.75,indicator:'Ø§ØªØ¬Ø§Ù‡Ø§Øª Ù†Ø­Ùˆ Ø§Ù„Ø°Ø§Øª ÙˆØ§Ù„Ù†Ù…Ùˆ.',improve:'Ø¨Ø±Ø§Ù…Ø¬ Ù…Ù‡Ø§Ø±ÙŠØ© ÙˆÙ…Ø³Ø§Ø±Ø§Øª Ù‚ÙŠØ§Ø¯Ø©.',evidence:'ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ø±Ø§Ù…Ø¬.'},
    {level:'Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚',perf:89.25,indicator:'Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ø°Ø§ØªÙŠ.',improve:'Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨Ø­Ø« Ø±Ù‚Ù…ÙŠØ©.',evidence:'Ø¨Ø­ÙˆØ« Ø·Ù„Ø§Ø¨ÙŠØ©.'},
    {level:'Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚',perf:86.25,indicator:'Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© ÙˆØµØ­ÙŠØ©.',improve:'Ø­Ù…Ù„Ø§Øª ØªÙˆØ¹ÙˆÙŠØ©.',evidence:'Ù†Ø´Ø±Ø§Øª ÙˆØªÙ‚Ø§Ø±ÙŠØ±.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:84.25,indicator:'Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ù…Ø¬ØªÙ…Ø¹ÙŠØ©.',improve:'Ø´Ø±Ø§ÙƒØ§Øª Ù†ÙˆØ¹ÙŠØ©.',evidence:'Ù…Ø°ÙƒØ±Ø§Øª ØªØ¹Ø§ÙˆÙ†.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:82.94,indicator:'ØªÙ‚Ø¯Ù… ÙÙŠ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ÙˆØ§Ø¯.',improve:'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ®Ø·Ø· Ø¯Ø¹Ù….',evidence:'ØªÙ‚Ø§Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:79.04,indicator:'ØªØ­Ù‚Ù‚ Ù†ÙˆØ§ØªØ¬ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©.',improve:'ØªÙ‚ÙˆÙŠÙ… Ù…Ø³ØªÙ…Ø± ÙˆØ®Ø·Ø· ØªØ­Ø³ÙŠÙ†.',evidence:'Ø£Ø¯ÙˆØ§Øª ØªÙ‚ÙˆÙŠÙ….'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:63.25,indicator:'Ù…Ø´Ø§Ø±ÙƒØ© Ø«Ù‚Ø§ÙÙŠØ©/Ù‚ÙŠÙ…ÙŠØ©.',improve:'ØªØ­ÙÙŠØ² Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©.',evidence:'ØªÙ‚Ø§Ø±ÙŠØ± Ø£Ù†Ø´Ø·Ø©.'}
  ],
  environment:[
    {level:'Ø§Ù„ØªÙ…ÙŠÙ‘Ø²',perf:97.50,indicator:'ØªÙ‡ÙŠØ¦Ø© ÙˆØµÙŠØ§Ù†Ø© Ù…Ø±Ø§ÙÙ‚ Ø§Ù„Ù…Ø¨Ù†Ù‰.',improve:'Ø³Ø¬Ù„ Ø±Ù‚Ù…ÙŠ Ù„Ù„ØµÙŠØ§Ù†Ø©.',evidence:'ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØµÙˆØ±.'},
    {level:'Ø§Ù„ØªÙ…ÙŠÙ‘Ø²',perf:97.00,indicator:'Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§ÙØ©.',improve:'ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø¥Ø´Ø±Ø§Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ.',evidence:'ØªÙ‚Ø§Ø±ÙŠØ± Ø¥Ø´Ø±Ø§ÙÙŠØ©.'},
    {level:'Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚',perf:94.00,indicator:'ØªÙˆØ§ÙØ± Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£Ù…Ù† ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø©.',improve:'ÙØ±Ø¶ÙŠØ§Øª Ø¯ÙˆØ±ÙŠØ© ÙˆØªØ­Ø¯ÙŠØ« Ø£Ø¯ÙˆØ§Øª.',evidence:'Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ù…Ù† ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø©.'},
    {level:'Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚',perf:79.00,indicator:'ÙˆØµÙˆÙ„Ø§Øª Ø¢Ù…Ù†Ø© ÙˆÙ…ÙŠØ³Ù‘ÙØ±Ø©.',improve:'ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ù…Ø±Ø§Øª Ù„Ø°ÙˆÙŠ Ø§Ù„Ø¥Ø¹Ø§Ù‚Ø©.',evidence:'ØµÙˆØ± ØªØ¬Ù‡ÙŠØ²Ø§Øª.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:73.25,indicator:'Ø¬Ø§Ø°Ø¨ÙŠØ© Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©.',improve:'ØªØ­Ø³ÙŠÙ† Ø¬Ù…Ø§Ù„ÙŠ ÙˆÙˆØ¸ÙŠÙÙŠ.',evidence:'ØµÙˆØ± Ø§Ù„ÙØµÙˆÙ„.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:64.00,indicator:'Ù…Ø®Ø§Ø±Ø¬ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙˆØ§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª.',improve:'Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ø®Ø§Ø±Ø¬ ÙˆØ¥Ø±Ø´Ø§Ø¯Ø§Øª.',evidence:'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ù…Ø¯Ù†ÙŠ.'},
    {level:'Ø§Ù„ØªÙ‡ÙŠØ¦Ø©',perf:62.50,indicator:'Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© ÙˆØ§Ù„ØªÙ‡ÙˆÙŠØ©.',improve:'ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© ÙˆØµÙŠØ§Ù†Ø© Ø§Ù„ØªÙ‡ÙˆÙŠØ©.',evidence:'ØªÙ‚Ø§Ø±ÙŠØ± ÙÙ†ÙŠØ©.'}
  ]
};

/* Supabase (Ø­ÙØ¸/Ø¬Ù„Ø¨ Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯) */
const SB_URL="https://vullbssjyyrnoyyxyebq.supabase.co";
const SB_ANON="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ1bGxic3NqeXlybm95eXh5ZWJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2OTQxODEsImV4cCI6MjA3NjI3MDE4MX0.D7o-dAyQbb2cjmp1ooZ0Mw9xoiih1JUarsEMZJVGfGc";
const supabase=window.supabase?window.supabase.createClient(SB_URL,SB_ANON):null;

async function uploadEvidenceFile(file, pathPrefix){
  if(!supabase || !file) return {url:''};
  const path=`${pathPrefix}/${Date.now()}_${file.name}`.replace(/\s+/g,'_');
  const {data, error}=await supabase.storage.from('evidence').upload(path, file, {upsert:true, contentType:file.type});
  if(error) return {error};
  const { data:pub } = supabase.storage.from('evidence').getPublicUrl(data.path);
  return {url: pub.publicUrl};
}
async function insertEvidence(row){ if(!supabase) return {error:'noClient'}; return await supabase.from('evidences').insert(row).select(); }
async function fetchEvidencesByField(fieldKey){
  if(!supabase) return {error:'noClient', data:[]};
  const {data, error}=await supabase.from('evidences').select('id,field_key,row_index,text,term,week,hijri,file_url,created_at').eq('field_key', fieldKey).order('id', {ascending:true});
  if(error) return {error, data:[]};
  const grouped={}; data.forEach(r=>{const idx=Number(r.row_index)||0; if(!grouped[idx]) grouped[idx]=[]; grouped[idx].push(r);});
  return {data:grouped};
}

/* Ø±Ø£Ø³ Ù…ÙˆØ­Ù‘Ø¯ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± (Ù…Ø®ÙÙŠ Ø§Ù„Ù…ØµØ¯Ø±) */
function bannerHeaderHTML(){
  return `
    <div class="hero" style="margin:0 0 10px;height:var(--hero-h);background:var(--bg)">
      <div class="brand" style="height:calc(var(--hero-h) - 24px)"></div>
    </div>`;
}

/* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±/Ø§Ù„Ø®Ø·Ø· */
function openDocWindow(title,contentHTML){
  const w=window.open('','_blank'); if(!w){alert('ÙØ¶Ù„Ø§Ù‹ Ø§Ø³Ù…Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©.');return;}
  const doc=`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"/><title>${title}</title>
  <style>
    :root{--moe:#0b7e88;--ink:#06353b;--bg:#f5f8f8;--card:#ffffff;--lv-excel:#16a34a;--lv-progress:#2563eb;--lv-launch:#f59e0b;--lv-ready:#e11d48;--hero-h: clamp(220px, 30vh, 360px);}
    @page{size:A4;margin:10mm}
    html,body{margin:0;background:#fff;color:#06353b;font-family:'Tajawal',sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility;font-kerning:normal;font-synthesis:none}
    .hero{width:100vw;margin-left:calc(50% - 50vw);background:var(--bg);border-radius:0 0 24px 24px;box-shadow:0 10px 24px rgba(0,0,0,.10);padding:0;height:var(--hero-h);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
    .brand{width:min(1200px,92vw);height:calc(var(--hero-h) - 24px);margin:0 auto;background:url('logo.png') center/contain no-repeat}
    .wrap{max-width:1120px;margin:0 auto;padding:12px}
    h2{margin:6px 0;color:#0b7e88;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:clip}
    h3{color:#0b7e88;margin:8px 0}
    table{width:100%;border-collapse:collapse;margin-top:8px;table-layout:fixed}
    thead th{background:#0f6f79;color:#fff;padding:8px;font-weight:700}
    td,th{padding:8px;border:1px solid #e7eff0;vertical-align:middle;text-align:center;font-size:13px;word-break:break-word}
    .row-excellent{background:#e9fff4}.row-verygood{background:#eef5ff}.row-good{background:#fff6ec}.row-medium{background:#ffefef}
    .toolbar{position:sticky;top:0;background:#fff;padding:6px 0;margin:6px 0;border-bottom:1px dashed #e1ecec;text-align:center}
    .btn{padding:8px 12px;border:1px solid #0b7e88;border-radius:8px;background:#0b7e88;color:#fff;cursor:pointer;margin:0 4px}
    .sig{font-size:12px;text-align:center;margin-top:8px;color:#345}
    .badge{background:none;border:none;padding:0;font-size:19px;font-weight:700;line-height:1;white-space:nowrap;letter-spacing:0;-webkit-text-stroke:0;text-shadow:none}
    .badge.excel{color:#16a34a}.badge.progress{color:#2563eb}.badge.launch{color:#f59e0b}.badge.ready{color:#e11d48}
    .meta{display:none}
    .small-list{font-size:13px;line-height:1.45}.small-list li{margin:.2rem 0}
    .evi-chip{display:inline-block;font-size:12px;font-weight:700;padding:4px 8px;border-radius:999px;margin:.2rem .2rem 0 0;background:rgba(6,53,59,.06);color:#06353b}
  </style></head><body>
  ${bannerHeaderHTML()}
  <div class="wrap">
    <div class="meta">Ù…ØµØ¯Ø±: <a href="${SRC_2025}" target="_blank">2025</a> â€¢ <a href="${SRC_2024}" target="_blank">2024</a> â€¢ Ø¢Ø®Ø± Ù…Ø²Ø§Ù…Ù†Ø©: ${LAST_SYNC}</div>
    ${contentHTML}
    <div class="toolbar no-print"><button class="btn" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø©</button><button class="btn" onclick="window.close()">Ø¥ØºÙ„Ø§Ù‚</button></div>
  </div></body></html>`;
  w.document.open(); w.document.write(doc); w.document.close();
}

/* Ø¹Ø§Ø±Ø¶ PDF Ù„Ù„Ø´ÙˆØ§Ù‡Ø¯ */
function openEvidenceViewerPDF(url){
  const w=window.open('','_blank'); if(!w){alert('ÙØ¶Ù„Ø§Ù‹ Ø§Ø³Ù…Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©.');return;}
  const doc=`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"/><title>Ø´Ø§Ù‡Ø¯</title>
  <style>@page{size:A4;margin:10mm}html,body{margin:0;height:100%}</style></head><body>
  <embed src="${url}" type="application/pdf" style="width:100%;height:100vh;border:0"/></body></html>`;
  w.document.open(); w.document.write(doc); w.document.close();
}

/* ===== Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙ‚Ø·: Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© ===== */
function renderDashboard(){
  const dash=document.getElementById('dashboard');
  dash.innerHTML='';
  Object.entries(fields).forEach(([key,f])=>{
    const lvl=perfLevel(f.v2025);
    const card=document.createElement('div');
    card.className='card'; card.id=`card-${key}`;
    card.innerHTML=`
      <h2>${f.name}</h2>
      <div class="kpi">
        <span>2024: ${fmt(f.v2024)}% â†’ 2025: ${fmt(f.v2025)}%</span>
        <!-- Ø­ÙØ°ÙØª Ø§Ù„Ø´Ø§Ø±Ø© Ù…Ù† Ù‡Ù†Ø§ -->
      </div>
      <div class="progress"><div class="bar" style="width:${Math.max(2,f.v2025)}%;background:${lvl.color}"></div></div>

      <div class="donutWrap">
        <canvas id="donut-${key}" class="donutCanvas"></canvas>
        <div class="donutCenter">
          <div class="lvl" style="color:${lvl.color}">${lvl.name}</div>
          <div class="pct">${fmt(f.v2025)}%</div>
        </div>
      </div>

      <div class="centerBar">
        <button class="btn micro" onclick="openFieldReport('${key}')">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¬Ø§Ù„</button>
        <button class="btn micro" onclick="openFieldPlan('${key}')">Ø®Ø·Ø© Ø§Ù„Ù…Ø¬Ø§Ù„</button>
      </div>`;
    dash.appendChild(card);

    try{
      const ctx=document.getElementById(`donut-${key}`).getContext('2d');
      new Chart(ctx,{
        type:'doughnut',
        data:{labels:f.subs.map(s=>s.name),datasets:[{data:f.subs.map(s=>s.v),backgroundColor:f.subs.map(s=>perfLevel(s.v).color)}]},
        options:{plugins:{legend:{display:false}},cutout:'72%',responsive:true,maintainAspectRatio:false}
      });
      document.getElementById(`donut-${key}`).addEventListener('click',()=>openFieldFullScreen(key));
    }catch(e){}
  });
}

/* ===== ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¬Ø§Ù„ (ÙŠØ¹Ø±Ø¶ Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©) ===== */
async function openFieldFullScreen(key){
  const panel=document.getElementById('fullPanel');
  const title=document.getElementById('fpTitle');
  const body=document.getElementById('fpBody');
  const f=fields[key]; title.textContent='Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ â€“ '+f.name;

  const subsHtml=f.subs.map(s=>{
    const lb=perfLevel(s.v);
    return `<div class="subCard" style="background:${lb.color}10;border-color:${lb.color}40;box-shadow:inset 0 0 0 1px ${lb.color}26;">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
        <strong>${s.name}</strong>
        <span class="badge ${lb.key}">${fmt(s.v)}% â€¢ ${lb.name}</span>
      </div>
    </div>`;
  }).join('');

  const {data:evByRow}=await fetchEvidencesByField(key);

  const rows=(detailed[key]||[]).map((r,i)=>{
    const lcls=levelRowClass(r.level);
    const lb=perfLevel(r.perf);
    const evisArr=(evByRow && evByRow[i]) ? evByRow[i] : [];
    const evisHTML = evisArr.map((e,j)=>{
      const link = e.file_url || '';
      const name = e.text && e.text.trim()? e.text.trim() : ('Ø´Ø§Ù‡Ø¯ '+(j+1));
      return link
        ? `<a class="evi-chip" href="${link}" target="_blank" onclick="event.preventDefault();openEvidenceViewerPDF('${link}')">${name}</a>`
        : `<span class="evi-chip">${name}</span>`;
    }).join('');
    return `<tr class="${lcls}">
      <td class="level" style="text-align:center">${r.level}<div class="small">${fmt(r.perf)}% â€¢ ${lb.name}</div></td>
      <td>${r.indicator}</td>
      <td>${r.improve}</td>
      <td>
        ${r.evidence}
        ${evisHTML?`<div style="margin-top:6px">${evisHTML}</div>`:''}
        <div style="margin-top:10px;text-align:center;display:flex;gap:6px;justify-content:center;flex-wrap:wrap">
          <button class="btn-evi" onclick="openEvidence('${key}',${i})" title="Ø¥Ø¶Ø§ÙØ© Ø´Ø§Ù‡Ø¯">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 5v14M5 12h14" stroke-width="2" stroke-linecap="round"/></svg>Ø¥Ø¶Ø§ÙØ© Ø´Ø§Ù‡Ø¯
          </button>
          <button class="btn-evi" onclick="deleteEvidence('${key}',${i})" title="Ø­Ø°Ù Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 6h18M8 6v12m8-12v12M5 6l1 14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2l1-14" stroke-width="2" stroke-linecap="round"/></svg>Ø­Ø°Ù Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯
          </button>
        </div>
      </td>
    </tr>`;
  }).join('');

  body.innerHTML=`<div class="subgrid">${subsHtml}</div>
  <div class="tableWrap"><table>
    <thead><tr><th style="width:160px">Ø§Ù„Ù…Ø³ØªÙˆÙ‰/Ø§Ù„Ø£Ø¯Ø§Ø¡</th><th>Ø§Ù„Ù…Ø¹ÙŠØ§Ø±</th><th>Ù…Ù‚ØªØ±Ø­Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ†</th><th>Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯</th></tr></thead>
    <tbody>${rows}</tbody></table></div>`;
  panel.style.display='flex';
  document.getElementById('fpClose').onclick=()=>panel.style.display='none';
  document.getElementById('fpHome').onclick=()=>{panel.style.display='none';window.scrollTo({top:0,behavior:'smooth'})};
}

/* ===== Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯ (Ø­ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©) ===== */
let currentEvi={key:'',idx:0};
function fillWeeks(termVal){
  const sel=document.getElementById('eviWeek'); sel.innerHTML='';
  (termVal==='T1'?TERM1:TERM2).forEach(w=>{
    const o=document.createElement('option');
    o.value=`Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${w.w} â€” ${w.from}â†’${w.to}${w.note?` (${w.note})`:''}`;
    o.textContent=o.value; sel.appendChild(o);
  });
}
document.getElementById('eviTerm').addEventListener('change',e=>fillWeeks(e.target.value));
function openEvidence(fieldKey,rowIdx){
  currentEvi={key:fieldKey,idx:rowIdx};
  document.getElementById('eviOwner').value=`${fields[fieldKey].name} â€” Ø¨Ù†Ø¯ ${rowIdx+1}`;
  document.getElementById('eviText').value='';
  document.getElementById('eviHijri').value=todayHijri().replace(/\s/g,'');
  document.getElementById('eviFile').value='';
  document.getElementById('eviTerm').value='T1'; fillWeeks('T1');
  document.getElementById('eviModal').style.display='flex';
}
function closeEvidence(){document.getElementById('eviModal').style.display='none'}
document.getElementById('eviClose').onclick=closeEvidence;
document.getElementById('eviCancel').onclick=closeEvidence;

document.getElementById('eviSave').onclick=async ()=>{
  if(!supabase){alert('ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');return;}
  const text=document.getElementById('eviText').value.trim();
  const term=document.getElementById('eviTerm').value;
  const week=document.getElementById('eviWeek').value;
  const hijri=document.getElementById('eviHijri').value.trim()||todayHijri();
  const fileEl=document.getElementById('eviFile');
  const file=(fileEl.files && fileEl.files[0]) ? fileEl.files[0] : null;
  if(!text && !file){alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ù‡Ø¯ ÙˆØ§Ø±ÙØ¹ Ù…Ù„ÙÙ‹Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ).');return;}
  let file_url=''; if(file){const up=await uploadEvidenceFile(file, `${currentEvi.key}/${currentEvi.idx}`); if(up.error){alert('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù.');return;} else file_url=up.url||'';}
  const payload={ field_key:currentEvi.key, row_index:currentEvi.idx, text, term, week, hijri, file_url };
  const {error}=await insertEvidence(payload); if(error){alert('ØªØ¹Ø°Ù‘Ø± Ø­ÙØ¸ Ø§Ù„Ø´Ø§Ù‡Ø¯.');return;}
  closeEvidence(); document.getElementById('fullPanel').style.display='none'; openFieldFullScreen(currentEvi.key);
};
async function deleteEvidence(key,index){
  if(!supabase){alert('ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');return;}
  const {error}=await supabase.from('evidences').delete().eq('field_key', key).eq('row_index', index);
  if(error){alert('ØªØ¹Ø°Ù‘Ø± Ø­Ø°Ù Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯.');return;}
  alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù†Ø¯'); document.getElementById('fullPanel').style.display='none'; openFieldFullScreen(key);
}

/* ===== ØªÙ‚Ø§Ø±ÙŠØ±/Ø®Ø·Ø· Ø§Ù„Ù…Ø¬Ø§Ù„ (ÙƒÙ…Ø§ ÙƒØ§Ù†Øª) ===== */
function buildFieldReportHTML(key){
  const f=fields[key];
  const rows=(detailed[key]||[]).map(r=>`
    <tr class="${levelRowClass(r.level)}">
      <td>${r.level} â€” ${fmt(r.perf)}%</td>
      <td>${r.indicator}</td>
      <td>${r.improve}</td>
      <td>${r.evidence}</td>
    </tr>`).join('');
  const lvl=perfLevel(f.v2025);
  return `<h2 class="nowrap-title">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¬Ø§Ù„: ${f.name}</h2>
  <div style="text-align:center;margin:4px 0">Ø§Ù„Ø£Ø¯Ø§Ø¡ 2024: ${fmt(f.v2024)}% â€” Ø§Ù„Ø£Ø¯Ø§Ø¡ 2025: ${fmt(f.v2025)}%
    <span class="badge ${lvl.key}">Ù…Ø³ØªÙˆÙ‰ ${lvl.name}</span></div>
  <div class="tableWrap"><table>
    <thead><tr><th style="width:220px">Ø§Ù„Ù…Ø³ØªÙˆÙ‰/Ø§Ù„Ù†Ø³Ø¨Ø©</th><th style="width:310px">Ø§Ù„Ù…Ø¤Ø´Ø±</th><th style="width:270px">Ù…Ù‚ØªØ±Ø­Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ†</th><th style="width:250px">Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯</th></tr></thead>
    <tbody>${rows}</tbody>
  </table></div>
  <div class="sig">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ â€” Ø§Ù„ØªØ§Ø±ÙŠØ®: ${todayHijri()}</div>`;
}
function buildFieldPlanHTML(key){
  const f=fields[key];
  const rows=(detailed[key]||[]).slice(0,6).map((r,i)=>{
    const durations=['4 Ø£Ø³Ø§Ø¨ÙŠØ¹','6 Ø£Ø³Ø§Ø¨ÙŠØ¹','8 Ø£Ø³Ø§Ø¨ÙŠØ¹','10 Ø£Ø³Ø§Ø¨ÙŠØ¹','12 Ø£Ø³Ø¨ÙˆØ¹Ù‹Ø§','ÙØµÙ„ Ø¯Ø±Ø§Ø³ÙŠ ÙƒØ§Ù…Ù„'];
    return `<tr><td>${r.indicator}</td><td>${r.improve}</td><td>${durations[i]||'6 Ø£Ø³Ø§Ø¨ÙŠØ¹'}</td><td>${r.evidence}</td></tr>`;
  }).join('');
  return `<h2 class="nowrap-title">Ø®Ø·Ø© ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø¬Ø§Ù„: ${f.name}</h2>
  <div class="tableWrap"><table>
    <thead><tr><th>Ø§Ù„Ù‡Ø¯Ù/Ø§Ù„Ù…Ø¤Ø´Ø±</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØ­Ø³ÙŠÙ†ÙŠ</th><th>Ø§Ù„Ù…Ø¯Ø©</th><th>Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯</th></tr></thead>
    <tbody>${rows}</tbody>
  </table></div>
  <div class="sig">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ â€” Ø§Ù„ØªØ§Ø±ÙŠØ®: ${todayHijri()}</div>`;
}
function openFieldReport(key){openDocWindow('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¬Ø§Ù„',buildFieldReportHTML(key))}
function openFieldPlan(key){openDocWindow('Ø®Ø·Ø© ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø¬Ø§Ù„',buildFieldPlanHTML(key))}

/* ===== Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ ÙƒÙ…Ø§ ÙƒØ§Ù† ===== */
function buildComprehensiveReport(){
  const yearBlock=(year)=>{
    const list=Object.entries(fields).map(([k,f])=>{
      const val=year===2024?f.v2024:f.v2025; const lv=perfLevel(val);
      return `<tr><td style="text-align:right">${f.name}</td><td>${fmt(val)}%</td><td><span class="badge ${lv.key}">${lv.name}</span></td></tr>`;
    }).join('');
    return `<div style="border:1px solid #e7eff0;border-radius:12px;padding:8px">
      <h3 style="text-align:center;margin:4px 0">Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù… ${year}Ù…</h3>
      <div class="tableWrap"><table><thead><tr><th>Ø§Ù„Ù…Ø¬Ø§Ù„</th><th>Ø§Ù„Ù†Ø³Ø¨Ø©</th><th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th></tr></thead><tbody>${list}</tbody></table></div>
    </div>`;
  };

  const diffs=Object.entries(fields).map(([k,f])=>({name:f.name,d:f.v2025-f.v2024}));
  const strengthsFromDetails=[];
  Object.entries(detailed).forEach(([k,arr])=>{
    arr.forEach(item=>{
      if(item.perf>=90) strengthsFromDetails.push({field:fields[k].name, indicator:item.indicator, v:item.perf});
    });
  });

  const lowSubs=Object.entries(fields).flatMap(([k,f])=>f.subs.map(s=>({field:f.name,sub:s.name,v:s.v})));
  lowSubs.sort((a,b)=>a.v-b.v);

  const strengthsList=(strengthsFromDetails.length
    ? strengthsFromDetails.slice(0,8).map(x=>`<li>${x.field} â€” ${x.indicator} (${fmt(x.v)}%)</li>`).join('')
    : '<li>â€”</li>');
  const improvements=lowSubs.filter(x=>x.v<75).map(x=>`<li>${x.field} â€” ${x.sub} (${fmt(x.v)}%)</li>`).join('')||'<li>â€”</li>';
  const follow=lowSubs.filter(x=>x.v>=75 && x.v<90).map(x=>`<li>${x.field} â€” ${x.sub} (${fmt(x.v)}%)</li>`).join('')||'<li>â€”</li>';

  return `<h2 class="nowrap-title">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ø®Ø·Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ â€“ Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ÙŠØ¹Ù‚ÙˆØ¨ÙŠ Ø¨Ø§Ù„Ø®Ø¨Ø± (1447Ù‡Ù€)</h2>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">${yearBlock(2024)}${yearBlock(2025)}</div>
  <h3>ğŸŸ¦ Ù„ÙˆØ­Ø© Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª 2024 â†” 2025</h3>
  <div class="tableWrap"><table><thead><tr><th>Ø§Ù„Ù…Ø¬Ø§Ù„</th><th>ÙØ±Ù‚ Ø§Ù„Ù†Ø³Ø¨Ø©</th><th>Ø§Ù„Ø§ØªØ¬Ø§Ù‡</th></tr></thead><tbody>
  ${diffs.map(d=>{const sym=d.d>0?'â†‘ ØªØ­Ø³Ù‘Ù†':(d.d<0?'â†“ ØªØ±Ø§Ø¬Ø¹':'âŸ² Ø«Ø¨Ø§Øª'); const col=d.d>0?'#16a34a':(d.d<0?'#e11d48':'#2563eb'); return `<tr><td>${d.name}</td><td>${d.d>0?'+':''}${fmt(d.d)}</td><td style="color:${col};font-weight:700">${sym}</td></tr>`}).join('')}</tbody></table></div>
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
    <div style="border:1px solid #e7eff0;border-radius:12px;padding:8px">
      <h3 style="margin:4px 0;color:var(--lv-excel)">Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„ØªÙ…ÙŠÙ‘Ø²</h3>
      <ul class="small-list" style="text-align:right;margin:0 18px 8px 0">${strengthsList}</ul>
    </div>
    <div style="border:1px solid #e7eff0;border-radius:12px;padding:8px">
      <h3 style="margin:4px 0;color:var(--lv-launch)">Ø¬ÙˆØ§Ù†Ø¨ ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†</h3>
      <ul class="small-list" style="text-align:right;margin:0 18px 8px 0">${improvements}</ul>
    </div>
    <div style="border:1px solid #e7eff0;border-radius:12px;padding:8px">
      <h3 style="margin:4px 0;color:var(--lv-progress)">Ø¬ÙˆØ§Ù†Ø¨ Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØªØ«Ø¨ÙŠØª</h3>
      <ul class="small-list" style="text-align:right;margin:0 18px 8px 0">${follow}</ul>
    </div>
  </div>
  <div class="sig">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ â€” Ø§Ù„ØªØ§Ø±ÙŠØ®: ${todayHijri()}</div>`;
}

/* ===== Ø®Ø·Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ† ÙƒÙ…Ø§ ÙƒØ§Ù†Øª ===== */
function buildImprovementPlan(){
  const rows=Object.entries(fields).map(([k,f])=>{
    const lv=perfLevel(f.v2025);
    const goalGeneral = (f.v2025>=90)
      ? 'Ø§Ø³ØªØ¯Ø§Ù…Ø© Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙ…ÙŠÙ‘Ø² ÙˆØ±ÙØ¹ Ø§Ù„Ù…ØªÙˆØ³Ø· Ø¥Ù„Ù‰ â‰¥ 92%'
      : (f.v2025>=75 ? 'Ø±ÙØ¹ Ø§Ù„Ù…ØªÙˆØ³Ø· Ø¥Ù„Ù‰ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªÙ…ÙŠÙ‘Ø² (â‰¥ 90%)'
         : (f.v2025>=50 ? 'Ø§Ù„Ø§Ø±ØªÙ‚Ø§Ø¡ Ø¥Ù„Ù‰ â‰¥ 75% Ø«Ù… Ø§Ù„ØªÙ‚Ø¯Ù‘Ù… Ù†Ø­Ùˆ 90%'
                        : 'Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ â‰¥ 50% Ø«Ù… Ù…ÙˆØ§ØµÙ„Ø© Ø§Ù„ØªØ­Ø³Ù† Ø¥Ù„Ù‰ 75%'));

    const subs=f.subs.map(s=>`${s.name} (${fmt(s.v)}%)`).join('ØŒ ');
    const indicatorKPI='Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø´Ù‡Ø±ÙŠØ©Ø› Ø¹Ø¯Ø¯ Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©Ø› ØªØ­Ø³Ù‘Ù† Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙØ±Ø¹ÙŠØ©Ø› Ø±Ø¶Ø§ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†';
    const tools='Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¤Ø´Ø±Ø§ØªØ› ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©Ø› Ø§Ø³ØªØ¨Ø§Ù†Ø§ØªØ› Ù…Ù„Ù Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯Ø› Ø²ÙŠØ§Ø±Ø§Øª ØµÙÙŠØ©';
    const mitigation='Ø¬Ø¯ÙˆÙ„Ø© ÙˆØ§Ø¶Ø­Ø©Ø› ØªØ­ÙÙŠØ² ÙˆÙ…Ø³Ø§Ø¡Ù„Ø©Ø› Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ²ÙŠØ¹ Ù…ÙˆØ§Ø±Ø¯Ø› Ø¯Ø¹Ù… ÙÙ†ÙŠ';
    const followup='Ø§Ø¬ØªÙ…Ø§Ø¹ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¬ÙˆØ¯Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ› ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠØ› Ù…Ø±Ø§Ø¬Ø¹Ø© ÙØµÙ„ÙŠØ©';
    const outputs='ØªØ­Ø³Ù† Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹ÙØ› Ø´ÙˆØ§Ù‡Ø¯ Ù…ÙˆØ«Ù‚Ø©Ø› Ù†Ø´Ø± Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª';

    return `<tr class="${levelRowClass(lv.name)}">
      <td style="width:14%">${fields[k].name}</td>
      <td style="width:12%"><span class="badge ${lv.key}">${lv.name}</span> â€” ${fmt(f.v2025)}%</td>
      <td style="width:18%">${goalGeneral}</td>
      <td style="width:18%">${subs}</td>
      <td style="width:14%">${indicatorKPI}</td>
      <td style="width:14%">${tools}</td>
      <td style="width:10%">${mitigation}</td>
      <td style="width:10%">${followup}</td>
      <td style="width:10%">${outputs}</td>
    </tr>`;
  }).join('');

  return `<h2 class="nowrap-title">Ø®Ø·Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ† â€“ Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ÙŠØ¹Ù‚ÙˆØ¨ÙŠ Ø¨Ø§Ù„Ø®Ø¨Ø±</h2>
  <div class="tableWrap"><table>
    <thead>
      <tr>
        <th>Ø§Ù„Ù…Ø¬Ø§Ù„</th>
        <th>Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø±Ø§Ù‡Ù†</th>
        <th>Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø¹Ø§Ù…</th>
        <th>Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø®Ø§ØµØ© (Ø§Ù„Ø¹Ù†Ø§ØµØ±)</th>
        <th>Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡</th>
        <th>Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ° ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</th>
        <th>Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª</th>
        <th>Ø¢Ù„ÙŠØ© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</th>
        <th>Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</th>
      </tr>
    </thead>
    <tbody>${rows}</tbody>
  </table></div>
  <div class="sig">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ â€” Ø§Ù„ØªØ§Ø±ÙŠØ®: ${todayHijri()}</div>`;
}

/* ØªØ´ØºÙŠÙ„ */
window.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('btnExt2025').addEventListener('click',()=>{window.open(SRC_2025,'_blank')});
  document.getElementById('btnExt2024').addEventListener('click',()=>{window.open(SRC_2024,'_blank')});
  document.getElementById('btnAnalyze').addEventListener('click',renderDashboard);
  document.getElementById('btnFullReport').addEventListener('click',()=>openDocWindow('Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„',buildComprehensiveReport()));
  document.getElementById('btnFullPlan').addEventListener('click',()=>openDocWindow('Ø®Ø·Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ†',buildImprovementPlan()));
  renderDashboard(); fillWeeks('T1');
});
</script>
</body>
</html>
